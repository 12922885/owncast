(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4208],{22825:function(e,t){"use strict";t.Z={src:"/_next/static/media/fediverse-black.0b51c805.png",height:100,width:100,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEVMaXEbGxsREREQEBAPDw8NDQ0FBQUQEBAQEBAUFBQNDQ0REREVFRUQEBAODg4UFBQUFBQHBwcNDQ1DUQGwAAAAE3RSTlMAC2QvWeDEnZQbSn15tW2ri/pAr8wTOgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAD1JREFUeJwdy0cOgDAMAMGNS2yHFPj/Z0GcRwMwegNaWbgB3WfmZSArZd7eqR0qEYM6GT/pc/bygqal8v0XMgEBhHcrytIAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}},44208:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthModal:function(){return I}});var a=n(85893),i=n(90575),r=n(4480),s=n(8751),o=n(54907),c=n(84485),d=n(11382),l=n(26713),u=n(14670),h=n(69677),A=n(71577),p=n(67294),g=n(37174);let{Panel:y}=o.Z,{Link:f}=c.Z,j=e=>{let{authenticated:t,displayName:n,accessToken:i}=e,[r,c]=(0,p.useState)(null),[j,v]=(0,p.useState)(!1),[x,m]=(0,p.useState)(!1),[w,b]=(0,p.useState)(""),E=t?(0,a.jsxs)("span",{children:[(0,a.jsx)("b",{children:"You are already authenticated"}),". However, you can add other domains or log in as a different user."]}):(0,a.jsxs)("span",{children:["Use your own domain to authenticate ",(0,a.jsx)("span",{children:n})," or login as a previously"," ","authenticated chat user using IndieAuth."]}),S=r;S&&S.includes("url does not support indieauth")&&(S="The provided URL is either invalid or does not support IndieAuth.");let Z=e=>{if(!(0,g.jv)(e)||!e.includes(".")){m(!1);return}m(!0)},B=e=>{let t=e.nativeEvent.data;if(":"===t)return;b(e.target.value);let n="https://".concat(e.target.value);Z(n)},I=async()=>{if(x){v(!0);try{let e=await fetch("/api/auth/indieauth?accessToken=".concat(i),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({authHost:"https://".concat(w)})}),t=await e.json();if(t.message){c(t.message),v(!1);return}if(!t.redirect){c("Auth provider did not return a redirect URL."),v(!1);return}if(t.redirect){let{redirect:n}=t;window.location=n}}catch(a){c(a.message)}v(!1)}};return(0,a.jsx)(d.Z,{spinning:j,children:(0,a.jsxs)(l.Z,{direction:"vertical",children:[E,S&&(0,a.jsx)(u.Z,{message:"Error",description:S,type:"error",showIcon:!0}),(0,a.jsx)("div",{children:"Your domain"}),(0,a.jsx)(h.Z.Search,{addonBefore:"https://",onInput:B,type:"url",value:w,placeholder:"yoursite.com",status:!x&&w.length>0?"error":void 0,onSearch:I,enterButton:(0,a.jsx)(A.Z,{type:x?"primary":"default",disabled:!x||0===w.length,children:(0,a.jsx)(s.Z,{})})}),(0,a.jsx)(o.Z,{ghost:!0,children:(0,a.jsxs)(y,{header:"Learn more about using IndieAuth to authenticate with chat.",children:[(0,a.jsx)("p",{children:"IndieAuth allows for a completely independent and decentralized way of identifying yourself using your own domain."}),(0,a.jsxs)("p",{children:["If you run an Owncast instance, you can use that domain here. Otherwise,"," ",(0,a.jsx)(f,{href:"https://indieauth.net/#providers",children:"learn more about how you can support IndieAuth"}),"."]})]},"header")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Note"}),": This is for authentication purposes only, and no personal information will be accessed or stored."]})]})})};var v=n(50501),x=n.n(v);let{Panel:m}=o.Z,w=e=>{let{authenticated:t,displayName:n,accessToken:i}=e,[r,c]=(0,p.useState)(null),[g,y]=(0,p.useState)(!1),[f,j]=(0,p.useState)(!1),[v,w]=(0,p.useState)(""),[b,E]=(0,p.useState)(""),[S,Z]=(0,p.useState)(!1),B=t?(0,a.jsxs)("span",{children:[(0,a.jsx)("b",{children:"You are already authenticated"}),". However, you can add other domains or log in as a different user."]}):(0,a.jsxs)("span",{children:["Receive a direct message on the Fediverse to link your account to"," ",(0,a.jsx)("strong",{children:n}),", or login as a previously linked chat user."]}),I=r;I&&I.includes("url does not support indieauth")&&(I="The provided URL is either invalid or does not support IndieAuth.");let U=e=>{j(function(e){let t=e.replace(/^@+/,"");return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}(e))},F=e=>{w(e.target.value),U(e.target.value)},O=async(e,t)=>{let n=await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}),a=await n.json();a.message&&(c(a.message),y(!1))},T=async()=>{y(!0);try{await O("/api/auth/fediverse/verify?accessToken=".concat(i),{code:b}),window.location.href="/"}catch(e){console.error(e),c(e)}y(!1)},k=async()=>{if(!f)return;y(!0),c(null);let e=v.replace(/^@+/,"");try{await O("/api/auth/fediverse?accessToken=".concat(i),{account:e}),Z(!0)}catch(t){console.error(t),c(t)}y(!1)},C=(0,a.jsxs)("div",{children:["Paste in the code that was sent to your Fediverse account. If you did not receive a code, make sure you can accept direct messages.",(0,a.jsxs)("div",{className:x().codeInputContainer,children:[(0,a.jsx)(h.Z,{value:b,onChange:e=>E(e.target.value),className:x().codeInput,placeholder:"123456",maxLength:6}),(0,a.jsx)(A.Z,{type:"primary",onClick:T,disabled:b.length<6,className:x().submitButton,children:"Verify Code"})]})]}),N=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{children:"Your Fediverse Account"}),(0,a.jsx)(h.Z.Search,{addonBefore:"@",onInput:F,value:v,placeholder:"youraccount@yourserver.com",status:!f&&v.length>0?"error":void 0,onSearch:k,enterButton:(0,a.jsx)(A.Z,{type:f?"primary":"default",disabled:!f||0===v.length,children:(0,a.jsx)(s.Z,{})})})]});return(0,a.jsx)(d.Z,{spinning:g,children:(0,a.jsxs)(l.Z,{direction:"vertical",children:[B,I&&(0,a.jsx)(u.Z,{message:"Error",description:I,type:"error",showIcon:!0}),S?C:N,(0,a.jsx)(o.Z,{ghost:!0,children:(0,a.jsx)(m,{header:"Learn more about using the Fediverse to authenticate with chat.",children:(0,a.jsx)("p",{children:"You can link your chat identity with your Fediverse identity. Next time you want to use this chat identity you can again go through the Fediverse authentication."})},"header")}),(0,a.jsxs)("div",{children:[(0,a.jsx)("strong",{children:"Note"}),": This is for authentication purposes only, and no personal information will be accessed or stored."]})]})})};var b=n(22825),E={src:"/_next/static/media/indieauth.38c52a3d.png",height:512,width:406,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAICAMAAADtGH4KAAAAJFBMVEU4ODg4ODg5OTk5OTk5OTk4ODg5OTk4ODg5OTk5OTk5OTk4ODiRUFfYAAAAC3RSTlMCFOuovTv1zI8wabTrOYwAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAsSURBVHicBcGFAQAwDMCg1Gb5/98BHG1gd2UQGeQwVvl4ujyUEzbbi8nyhn4bVgEfoFU38wAAAABJRU5ErkJggg==",blurWidth:6,blurHeight:8},S=n(54639),Z=n.n(S),B=n(77466);let I=e=>{let{forceTabs:t}=e,n=(0,r.sJ)(B.L4),s=(0,r.sJ)(B.FI),o=(0,r.sJ)(B.db),c=(0,r.sJ)(B.g1);if(!o)return null;let{displayName:d}=o,{federation:l}=c,{enabled:u}=l,h=(0,a.jsxs)("span",{className:Z().tabContent,children:[(0,a.jsx)("img",{className:Z().icon,src:E.src,alt:"IndieAuth"}),"IndieAuth"]}),A=(0,a.jsx)(j,{authenticated:n,displayName:d,accessToken:s}),p=(0,a.jsxs)("span",{className:Z().tabContent,children:[(0,a.jsx)("img",{className:Z().icon,src:b.Z.src,alt:"Fediverse auth"}),"FediAuth"]}),g=(0,a.jsx)(w,{authenticated:n,displayName:d,accessToken:s});return(0,a.jsx)("div",{children:(0,a.jsx)(i.Z,{defaultActiveKey:"1",items:[{label:h,key:"1",children:A},{label:p,key:"2",children:g}],type:"card",size:"small",renderTabBar:u||t?null:()=>null})})}},37174:function(e,t,n){"use strict";n.d(t,{Kf:function(){return r},ax:function(){return a},bu:function(){return s},jv:function(){return i}});let a="https?://.*";function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["http:","https:"];try{let n=new URL(e);if(""===n.protocol||""===n.hostname||!t.includes(n.protocol))return!1}catch(a){return!1}return!0}function r(e,t){e.startsWith("@")&&(e=e.slice(1));let n=e.split(/:|@/),[a,i,r]=n;return console.log({account:e,protocol:t,service:a,user:i,host:r}),a===t&&3===n.length&&!!a&&!!i&&!!r}function s(e){if(!e.startsWith("matrix:"))return!1;(e=e.slice(7)).startsWith("@")&&(e=e.slice(1));let t=e.split(":"),[n,a]=t;return 2===t.length&&!!n&&!!a}},54639:function(e){e.exports={tabContent:"AuthModal_tabContent__KgMU3",icon:"AuthModal_icon__kpEuV"}},50501:function(e){e.exports={codeInputContainer:"FediAuthModal_codeInputContainer__M_dAD",codeInput:"FediAuthModal_codeInput__dIE6u",submitButton:"FediAuthModal_submitButton__iuF9R"}}}]);
//# sourceMappingURL=4208.c9c9eb8101bbc886.js.map