(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4977],{94977:function(e,t,s){"use strict";s.r(t),s.d(t,{ChatContainer:function(){return ge}});var a=s(85893),n=s(26246),r=s(67294),o=s(36531),i=s(91951),l=s(59760),c=s.n(l),d=s(94184),h=s.n(d),u=s(29158),m=s(4480),g=s(5152),p=s.n(g),x=s(27722),_=s(50085),C=s.n(_),f=s(77278);function v(e){const t=new Date(e);if(Number.isNaN(t))return"";if((0,f.Xb)(e)>=1){const e=t.toLocaleDateString("en-US",{dateStyle:"medium"});return"".concat(e," at ").concat(t.toLocaleTimeString())}return"".concat(t.toLocaleTimeString())}var j=s(48976),y=s.n(j);const N=e=>{let{badge:t,userColor:s}=e;const n="var(--theme-user-colors-".concat(s,")"),r={color:n,borderColor:n};return(0,a.jsx)("span",{style:r,className:y().badge,children:t})};var M=s(77466);const b=p()((()=>Promise.all([s.e(4885),s.e(5596),s.e(481),s.e(173),s.e(6880),s.e(3174),s.e(6386),s.e(3013),s.e(3698),s.e(8213),s.e(9915),s.e(715),s.e(5402),s.e(1908),s.e(575),s.e(7910),s.e(428),s.e(7916),s.e(2918),s.e(8119),s.e(3859),s.e(6113),s.e(1055)]).then(s.bind(s,86113)).then((e=>e.Tooltip))),{loadableGenerated:{webpack:()=>[86113]},ssr:!1}),S=p()((()=>Promise.all([s.e(5596),s.e(481),s.e(173),s.e(3174),s.e(6386),s.e(3013),s.e(3698),s.e(8213),s.e(715),s.e(5402),s.e(1908),s.e(1834),s.e(8067),s.e(4136),s.e(4860)]).then(s.bind(s,94860)).then((e=>e.ChatModerationActionMenu))),{loadableGenerated:{webpack:()=>[94860]}}),T=p()((()=>Promise.resolve().then(s.bind(s,47049)).then((e=>e.Highlight))),{loadableGenerated:{webpack:()=>[47049]}}),w=e=>{let{children:t,user:s}=e;const{displayName:n,createdAt:r}=s,o="".concat(n," first joined ").concat(v(r));return(0,a.jsx)(b,{title:o,placement:"topLeft",mouseEnterDelay:1,children:t})},E=e=>{let{message:t,highlightString:s,showModeratorMenu:n,sentBySelf:o,sameUserAsLast:i,isAuthorModerator:l,isAuthorAuthenticated:c}=e;const{id:d,body:g,user:p,timestamp:_}=t,{id:f,displayName:j,displayColor:y}=p,E=(0,m.sJ)(M.FI),k="var(--theme-color-users-".concat(y,")"),A="Sent ".concat(v(_)),[O,D]=(0,r.useState)(g),B=[];return l&&B.push((0,a.jsx)(N,{badge:"mod",userColor:y},"mod")),c&&B.push((0,a.jsx)(N,{badge:(0,a.jsx)(u.Z,{title:"authenticated"}),userColor:y},"auth")),(0,r.useEffect)((()=>{D((0,x.p1)(g))}),[t]),(0,a.jsx)("div",{className:h()(C().messagePadding,i&&C().messagePaddingCollapsed,"chat-message_user"),children:(0,a.jsxs)("div",{className:h()(C().root,{[C().ownMessage]:o}),style:{borderColor:k},children:[!i&&(0,a.jsx)(w,{user:p,children:(0,a.jsxs)("div",{className:C().user,style:{color:k},children:[(0,a.jsx)("span",{className:C().userName,children:j}),(0,a.jsx)("span",{children:B})]})}),(0,a.jsx)(b,{title:A,mouseEnterDelay:1,children:(0,a.jsx)(T,{search:s,children:(0,a.jsx)("div",{className:C().message,dangerouslySetInnerHTML:{__html:O}})})}),n&&(0,a.jsx)("div",{className:C().modMenuWrapper,children:(0,a.jsx)(S,{messageID:d,accessToken:E,userID:f,userDisplayName:j})}),(0,a.jsx)("div",{className:C().background,style:{color:k}})]})})};var k=s(93045),A=s(27496),O=s(55241),D=s(77493),B=s(96391),U=s(26912),F=s.n(U);const L=p()((()=>Promise.all([s.e(7741),s.e(1559)]).then(s.bind(s,51559)).then((e=>e.EmojiPicker))),{loadableGenerated:{webpack:()=>[51559]}}),R=e=>{const{attributes:t,element:s,children:n}=e,r=(0,B.vt)(),o=(0,B.UE)();return(0,a.jsxs)("span",{...t,contentEditable:!1,children:[(0,a.jsx)("img",{alt:s.alt,src:s.src,title:s.name,style:{display:"inline",maxWidth:"50px",maxHeight:"20px",boxShadow:"".concat(r&&o?"0 0 0 3px #B4D5FF":"none")}}),n]})},I=e=>{if(D.xv.isText(e)){return e.text}let t;var s;0===e.children.length?t=[{text:""}]:t=null===(s=e.children)||void 0===s?void 0:s.map((e=>I(e))).join("");switch(e.type){case"paragraph":return"<p>".concat(t,"</p>");case"image":return'<img src="'.concat(e.src,'" alt="').concat(e.alt,'" title="').concat(e.name,'" class="emoji"/>');default:return t}},P=e=>{if(D.xv.isText(e))return e.text.length;if("image"===e.type)return 5;let t=0;return e.children.forEach((e=>{t+=P(e)})),t},H=e=>{let{defaultText:t}=e;const[s,n]=(0,r.useState)(!1),[o,l]=(0,r.useState)(null===t||void 0===t?void 0:t.length),c=(0,m.sJ)(M.Gt),d=(0,r.useMemo)((()=>(0,B.BU)((e=>{const{isVoid:t}=e;return e.isVoid=e=>"image"===e.type||t(e),e.isInline=e=>"image"===e.type,e})((0,D.Jh)()))),[]),u=[{type:"paragraph",children:[{text:t||""}]}],g=()=>{if(!c)return void console.log("websocketService is not defined");const e=I(d);c.send({type:i.C.CHAT,body:e}),D.YR.delete(d,{at:{anchor:D.ML.start(d,[]),focus:D.ML.end(d,[])}}),l(0)};return(0,a.jsx)("div",{className:F().root,children:(0,a.jsxs)("div",{className:h()(F().inputWrap,o>=300&&F().maxCharacters),children:[(0,a.jsxs)(B.mH,{editor:d,value:u,children:[(0,a.jsx)(B.CX,{className:"chat-text-input",onKeyDown:e=>{const t=P(d)+1;if("Enter"===e.key)return e.preventDefault(),void g();"Backspace"!==e.key?(t+1>300&&e.preventDefault(),l(t+1)):l(t-1)},onPaste:e=>{const t=e.clipboardData.getData("text/plain"),{length:s}=t;o+s>300&&e.preventDefault()},renderElement:e=>"image"===e.element.type?(0,a.jsx)(R,{...e}):(0,a.jsx)("p",{...e}),placeholder:"Send a message to chat",style:{width:"100%"},role:"textbox","aria-label":"Chat text input",autoFocus:!0}),(0,a.jsx)(O.Z,{content:(0,a.jsx)(L,{onEmojiSelect:e=>{B.F3.focus(d),D.YR.insertText(d,e)},onCustomEmojiSelect:(e,t)=>{B.F3.focus(d),((e,t)=>{if(!e)return;const{selection:s}=d,a=((e,t,s)=>({type:"image",alt:e,src:t,name:s,children:[{text:""}]}))(t,e,t);if(D.YR.insertNodes(d,a,{select:!0}),s){var n;const[e,t]=D.ML.parent(d,null===(n=s.focus)||void 0===n?void 0:n.path);d.isVoid(e)||D.NB.string(e).length?D.YR.insertNodes(d,a,{at:D.y$.next(t),select:!0}):(D.YR.insertNodes(d,a,{at:t,select:!0}),D.ML.normalize(d,{force:!0}))}else D.YR.insertNodes(d,a,{select:!0})})(t,e)}}),trigger:"click",placement:"topRight",onOpenChange:e=>n(e),open:s})]}),(0,a.jsxs)("div",{style:{display:"flex",paddingLeft:"5px"},children:[(0,a.jsx)("button",{type:"button",className:F().emojiButton,title:"Emoji picker button",onClick:()=>n(!s),children:(0,a.jsx)(k.Z,{})}),(0,a.jsx)("button",{type:"button",className:F().sendButton,title:"Send message Button",onClick:g,children:(0,a.jsx)(A.Z,{})})]})]})})};var W,G,V,Y,J,X=s(93107),Z=s.n(X);function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e},z.apply(this,arguments)}var q=function(e){return r.createElement("svg",z({height:500,viewBox:"0 0 132.292 132.292",width:500,xmlns:"http://www.w3.org/2000/svg"},e),W||(W=r.createElement("linearGradient",{id:"moderator_svg__a",gradientUnits:"userSpaceOnUse",x1:432.851,x2:464.644,y1:49.977,y2:49.977},r.createElement("stop",{offset:0,stopColor:"#2087e2"}),r.createElement("stop",{offset:1,stopColor:"#b63fff"}))),G||(G=r.createElement("path",{d:"M438.672 34.08h20.151a5.82 5.82 45 0 1 5.82 5.821v20.151a5.82 5.82 135 0 1-5.82 5.821h-20.15a5.82 5.82 45 0 1-5.822-5.82V39.9a5.82 5.82 135 0 1 5.821-5.82z",fill:"url(#moderator_svg__a)",transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})),V||(V=r.createElement("path",{d:"M121.11 29.551c-6.93 47.444-30.074 104.618-77.642 79.674l25.83 23.067h38.772c13.377 0 24.22-10.845 24.22-24.222V40.864z",fill:"#1d1535",fillOpacity:.335})),Y||(Y=r.createElement("path",{d:"M66.775 13.257s-7.129 57.999-.63 99.312c6.565 41.724-81.568-74.394-49.619-79.203 31.949-4.809 50.249-20.11 50.249-20.11z",fill:"#e2e8f0",fillOpacity:.306})),J||(J=r.createElement("path",{d:"M435.995 42.072c6.797.447 12.753-4.806 12.753-4.806s5.955 5.253 12.752 4.806c-.581 12.745-7.495 20.586-12.752 20.628-5.188.042-12.172-7.883-12.753-20.628z",fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeWidth:2,transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})))};const K=()=>(0,a.jsxs)("div",{className:Z().chatModerationNotification,children:[(0,a.jsx)(q,{className:Z().icon}),"You are now a moderator."]});var $=s(47049),Q=s(23421),ee=s.n(Q);const te=e=>{let{message:{body:t,user:{displayName:s}},highlightString:n}=e;return(0,a.jsxs)("div",{className:h()([ee().chatSystemMessage,"chat-message_system"]),children:[(0,a.jsx)("div",{className:ee().user,children:(0,a.jsx)("span",{className:ee().userName,children:s})}),(0,a.jsx)($.Highlight,{search:n,children:(0,a.jsx)("div",{className:ee().message,dangerouslySetInnerHTML:{__html:t}})})]})};var se=s(55355),ae=s(91044),ne=s.n(ae);const re=e=>{let{isAuthorModerator:t,userColor:s,displayName:n}=e;const r="var(--theme-color-users-".concat(s,")");return(0,a.jsxs)("div",{className:ne().root,children:[(0,a.jsxs)("span",{style:{color:r},children:[(0,a.jsx)("span",{style:{padding:"0 10px"},children:(0,a.jsx)(se.Z,{})}),(0,a.jsx)("span",{style:{fontWeight:"bold"},children:n}),t&&(0,a.jsx)("span",{children:(0,a.jsx)(N,{badge:"mod",userColor:s})})]})," ","joined the chat."]})};var oe=s(66017),ie=s(71577);const le=e=>{let{chatContainerRef:t,messages:s}=e;return(0,a.jsx)("div",{className:c().toBottomWrap,children:(0,a.jsx)(ie.Z,{type:"default",style:{color:"currentColor"},icon:(0,a.jsx)(oe.Z,{}),onClick:()=>t.current.scrollToIndex({index:s.length-1,behavior:"auto"}),children:"Go to last message"})})};var ce=s(65302),de=s.n(ce);const he=e=>{let{body:t}=e;return(0,a.jsx)("div",{dangerouslySetInnerHTML:{__html:t},className:de().chatAction})};function ue(e,t){if(e.length<2)return!1;const s=e[t];if(!s||!s.user)return!1;const{user:{id:a}}=s,n=e[t-1];if((null===n||void 0===n?void 0:n.type)!==i.C.CHAT)return!1;if(!(null===n||void 0===n?void 0:n.timestamp)||!s.timestamp)return!1;const r=new Date(null===n||void 0===n?void 0:n.timestamp).getTime();return!(new Date(s.timestamp).getTime()-r>12e4)&&a===(null===n||void 0===n?void 0:n.user.id)}function me(e){const{user:{scopes:t}}=e;return!(!t||0===t.length)&&t.includes("MODERATOR")}const ge=e=>{let{messages:t,usernameToHighlight:s,chatUserId:l,isModerator:d,showInput:h,height:u}=e;const[m,g]=(0,r.useState)(!1),p=(0,r.useRef)(null),x=(e,n)=>{switch(n.type){case i.C.CHAT:var r,h,u;return(0,a.jsx)(E,{message:n,showModeratorMenu:d,highlightString:s,sentBySelf:(null===(r=n.user)||void 0===r?void 0:r.id)===l,sameUserAsLast:ue(t,e),isAuthorModerator:null===(h=n.user.scopes)||void 0===h?void 0:h.includes("MODERATOR"),isAuthorAuthenticated:null===(u=n.user)||void 0===u?void 0:u.authenticated},n.id);case i.C.NAME_CHANGE:return(e=>{const{oldName:t,user:s}=e,{displayName:n,displayColor:r}=s,i="var(--theme-color-users-".concat(r,")");return(0,a.jsxs)("div",{className:c().nameChangeView,children:[(0,a.jsx)("div",{style:{marginRight:5,height:"max-content",margin:"auto 5px auto 0"},children:(0,a.jsx)(o.Z,{})}),(0,a.jsxs)("div",{className:c().nameChangeText,children:[(0,a.jsx)("span",{style:{color:i},children:t}),(0,a.jsx)("span",{className:c().plain,children:" is now known as "}),(0,a.jsx)("span",{style:{color:i},children:n})]})]})})(n);case i.C.CONNECTED_USER_INFO:return(e=>{if(!me(e)){const e={width:"1px",height:"1px"};return(0,a.jsx)("div",{style:e})}return(0,a.jsx)(K,{})})(n);case i.C.USER_JOINED:return(e=>{const{user:{displayName:t,displayColor:s}}=e,n=me(e);return(0,a.jsx)(re,{displayName:t,userColor:s,isAuthorModerator:n})})(n);case i.C.CHAT_ACTION:return(e=>{const{body:t}=e;return(0,a.jsx)(he,{body:t})})(n);case i.C.SYSTEM:return(0,a.jsx)(te,{message:n,highlightString:s},n.id);default:return null}};(0,r.useEffect)((()=>{setTimeout((()=>{!function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"smooth";var a;null===(a=e.current)||void 0===a||a.scrollToIndex({index:t.length-1,behavior:s}),g(!0)}(p,"auto")}),500)}),[]);const _=(0,r.useMemo)((()=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.OO,{style:{height:u},className:c().virtuoso,ref:p,data:t,itemContent:(e,t)=>x(e,t),followOutput:e=>!!e&&"smooth",alignToBottom:!0,atBottomThreshold:50,atBottomStateChange:e=>{g(e)}}),!m&&(0,a.jsx)(le,{chatContainerRef:p,messages:t})]})),[t,s,l,d,m]);return(0,a.jsxs)("div",{id:"chat-container",className:c().chatContainer,children:[_,h&&(0,a.jsx)("div",{className:c().chatTextField,children:(0,a.jsx)(H,{})})]})};ge.defaultProps={showInput:!0,height:"auto"}},65302:function(e){e.exports={chatAction:"ChatActionMessage_chatAction__x9Xsg"}},59760:function(e){e.exports={toBottomWrap:"ChatContainer_toBottomWrap__3V5wa",nameChangeView:"ChatContainer_nameChangeView__ziyXN",nameChangeText:"ChatContainer_nameChangeText__yXG__",plain:"ChatContainer_plain__IPS19",chatContainer:"ChatContainer_chatContainer__O2lYN",virtuoso:"ChatContainer_virtuoso__OS9Kz",chatTextField:"ChatContainer_chatTextField__OqCGL"}},91044:function(e){e.exports={root:"ChatJoinMessage_root__vuVXa"}},93107:function(e){e.exports={chatModerationNotification:"ChatModeratorNotification_chatModerationNotification__kgFWe",icon:"ChatModeratorNotification_icon__7FdGg"}},23421:function(e){e.exports={chatSystemMessage:"ChatSystemMessage_chatSystemMessage__c6XEN",user:"ChatSystemMessage_user__6yHSJ",message:"ChatSystemMessage_message__ySq5g"}},26912:function(e){e.exports={root:"ChatTextField_root__4oUkJ",inputWrap:"ChatTextField_inputWrap__1mAjD",maxCharacters:"ChatTextField_maxCharacters__yGT4s",emojiButton:"ChatTextField_emojiButton__ON_Cu",sendButton:"ChatTextField_sendButton__MOmD4"}},48976:function(e){e.exports={badge:"ChatUserBadge_badge__1EdUp"}},50085:function(e){e.exports={root:"ChatUserMessage_root__79heB",user:"ChatUserMessage_user__xUEp9",message:"ChatUserMessage_message__MJ9LD",ownMessage:"ChatUserMessage_ownMessage__d28A3",background:"ChatUserMessage_background__Tfghp",modMenuWrapper:"ChatUserMessage_modMenuWrapper__7fblv",messagePadding:"ChatUserMessage_messagePadding__Xp1F6",messagePaddingCollapsed:"ChatUserMessage_messagePaddingCollapsed__qxN0E"}}}]);
//# sourceMappingURL=4977-f09c20c635083d30.js.map