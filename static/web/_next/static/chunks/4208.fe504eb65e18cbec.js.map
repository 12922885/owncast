{"version":3,"file":"static/chunks/4208.fe504eb65e18cbec.js","mappings":"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","sources":["webpack://_N_E/./assets/images/fediverse-black.png","webpack://_N_E/./components/modals/IndieAuthModal/IndieAuthModal.tsx","webpack://_N_E/./utils/validators.ts","webpack://_N_E/./components/modals/FediAuthModal/FediAuthModal.tsx","webpack://_N_E/./assets/images/indieauth.png","webpack://_N_E/./components/modals/AuthModal/AuthModal.tsx","webpack://_N_E/./utils/urls.ts","webpack://_N_E/./components/modals/AuthModal/AuthModal.module.scss","webpack://_N_E/./components/modals/FediAuthModal/FediAuthModal.module.scss","webpack://_N_E/<anon>"],"sourcesContent":["export default {\"src\":\"/_next/static/media/fediverse-black.0b51c805.png\",\"height\":100,\"width\":100,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEVMaXEbGxsREREQEBAPDw8NDQ0FBQUQEBAQEBAUFBQNDQ0REREVFRUQEBAODg4UFBQUFBQHBwcNDQ1DUQGwAAAAE3RSTlMAC2QvWeDEnZQbSn15tW2ri/pAr8wTOgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAD1JREFUeJwdy0cOgDAMAMGNS2yHFPj/Z0GcRwMwegNaWbgB3WfmZSArZd7eqR0qEYM6GT/pc/bygqal8v0XMgEBhHcrytIAAAAASUVORK5CYII=\",\"blurWidth\":8,\"blurHeight\":8};","import { CheckCircleOutlined } from '@ant-design/icons';\nimport { Alert, Input, Space, Spin, Collapse, Typography, Button } from 'antd';\nimport React, { FC, useState } from 'react';\nimport { isValidUrl } from '../../../utils/urls';\n\nconst { Panel } = Collapse;\nconst { Link } = Typography;\n\nexport type IndieAuthModalProps = {\n  authenticated: boolean;\n  displayName: string;\n  accessToken: string;\n};\n\nexport const IndieAuthModal: FC<IndieAuthModalProps> = ({\n  authenticated,\n  displayName: username,\n  accessToken,\n}) => {\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [valid, setValid] = useState(false);\n  const [host, setHost] = useState('');\n\n  const message = !authenticated ? (\n    <span>\n      Use your own domain to authenticate <span>{username}</span> or login as a previously{' '}\n      authenticated chat user using IndieAuth.\n    </span>\n  ) : (\n    <span>\n      <b>You are already authenticated</b>. However, you can add other domains or log in as a\n      different user.\n    </span>\n  );\n\n  let errorMessageText = errorMessage;\n  if (errorMessageText) {\n    if (errorMessageText.includes('url does not support indieauth')) {\n      errorMessageText = 'The provided URL is either invalid or does not support IndieAuth.';\n    }\n  }\n\n  const validate = (url: string) => {\n    if (!isValidUrl(url)) {\n      setValid(false);\n      return;\n    }\n\n    if (!url.includes('.')) {\n      setValid(false);\n      return;\n    }\n\n    setValid(true);\n  };\n\n  const onInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    // Don't allow people to type custom ports or protocols.\n    const char = (e.nativeEvent as any).data;\n    if (char === ':') {\n      return;\n    }\n\n    setHost(e.target.value);\n    const h = `https://${e.target.value}`;\n    validate(h);\n  };\n\n  const submitButtonPressed = async () => {\n    if (!valid) {\n      return;\n    }\n\n    setLoading(true);\n\n    try {\n      const url = `/api/auth/indieauth?accessToken=${accessToken}`;\n      const h = `https://${host}`;\n      const data = { authHost: h };\n      const rawResponse = await fetch(url, {\n        method: 'POST',\n        headers: {\n          Accept: 'application/json',\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(data),\n      });\n\n      const content = await rawResponse.json();\n      if (content.message) {\n        setErrorMessage(content.message);\n        setLoading(false);\n        return;\n      }\n      if (!content.redirect) {\n        setErrorMessage('Auth provider did not return a redirect URL.');\n        setLoading(false);\n        return;\n      }\n\n      if (content.redirect) {\n        const { redirect } = content;\n        window.location = redirect;\n      }\n    } catch (e) {\n      setErrorMessage(e.message);\n    }\n\n    setLoading(false);\n  };\n\n  return (\n    <Spin spinning={loading}>\n      <Space direction=\"vertical\">\n        {message}\n        {errorMessageText && (\n          <Alert message=\"Error\" description={errorMessageText} type=\"error\" showIcon />\n        )}\n        <div>Your domain</div>\n        <Input.Search\n          addonBefore=\"https://\"\n          onInput={onInput}\n          type=\"url\"\n          value={host}\n          placeholder=\"yoursite.com\"\n          status={!valid && host.length > 0 ? 'error' : undefined}\n          onSearch={submitButtonPressed}\n          enterButton={\n            <Button type={valid ? 'primary' : 'default'} disabled={!valid || host.length === 0}>\n              <CheckCircleOutlined />\n            </Button>\n          }\n        />\n\n        <Collapse ghost>\n          <Panel key=\"header\" header=\"Learn more about using IndieAuth to authenticate with chat.\">\n            <p>\n              IndieAuth allows for a completely independent and decentralized way of identifying\n              yourself using your own domain.\n            </p>\n\n            <p>\n              If you run an Owncast instance, you can use that domain here. Otherwise,{' '}\n              <Link href=\"https://indieauth.net/#providers\">\n                learn more about how you can support IndieAuth\n              </Link>\n              .\n            </p>\n          </Panel>\n        </Collapse>\n        <div>\n          <strong>Note</strong>: This is for authentication purposes only, and no personal\n          information will be accessed or stored.\n        </div>\n      </Space>\n    </Spin>\n  );\n};\n","// eslint-disable-next-line import/prefer-default-export\nexport function validateAccount(account) {\n  const a = account.replace(/^@+/, '');\n  const regex =\n    /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n  return regex.test(String(a).toLowerCase());\n}\n","import { Alert, Button, Input, Space, Spin, Collapse } from 'antd';\nimport React, { FC, useState } from 'react';\nimport { CheckCircleOutlined } from '@ant-design/icons';\nimport styles from './FediAuthModal.module.scss';\nimport { validateAccount } from '../../../utils/validators';\n\nconst { Panel } = Collapse;\n\nexport type FediAuthModalProps = {\n  authenticated: boolean;\n  displayName: string;\n  accessToken: string;\n};\n\nexport const FediAuthModal: FC<FediAuthModalProps> = ({\n  authenticated,\n  displayName,\n  accessToken,\n}) => {\n  const [errorMessage, setErrorMessage] = useState<string | null>(null);\n  const [loading, setLoading] = useState(false);\n  const [valid, setValid] = useState(false);\n  const [account, setAccount] = useState('');\n  const [code, setCode] = useState('');\n  const [verifyingCode, setVerifyingCode] = useState(false);\n\n  const message = !authenticated ? (\n    <span>\n      Receive a direct message on the Fediverse to link your account to{' '}\n      <strong>{displayName}</strong>, or login as a previously linked chat user.\n    </span>\n  ) : (\n    <span>\n      <b>You are already authenticated</b>. However, you can add other domains or log in as a\n      different user.\n    </span>\n  );\n\n  let errorMessageText = errorMessage;\n  if (errorMessageText) {\n    if (errorMessageText.includes('url does not support indieauth')) {\n      errorMessageText = 'The provided URL is either invalid or does not support IndieAuth.';\n    }\n  }\n\n  const validate = (acct: string) => {\n    setValid(validateAccount(acct));\n  };\n\n  const onInput = (e: React.ChangeEvent<HTMLInputElement>) => {\n    setAccount(e.target.value);\n    validate(e.target.value);\n  };\n\n  const makeRequest = async (url, data) => {\n    const rawResponse = await fetch(url, {\n      method: 'POST',\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(data),\n    });\n\n    const content = await rawResponse.json();\n    if (content.message) {\n      setErrorMessage(content.message);\n      setLoading(false);\n    }\n  };\n\n  const submitCodePressed = async () => {\n    setLoading(true);\n    const url = `/api/auth/fediverse/verify?accessToken=${accessToken}`;\n    const data = { code };\n\n    try {\n      await makeRequest(url, data);\n\n      // Success. Reload the page.\n      window.location.href = '/';\n    } catch (e) {\n      console.error(e);\n      setErrorMessage(e);\n    }\n    setLoading(false);\n  };\n\n  const submitAccountPressed = async () => {\n    if (!valid) {\n      return;\n    }\n\n    setLoading(true);\n    setErrorMessage(null);\n    const url = `/api/auth/fediverse?accessToken=${accessToken}`;\n    const normalizedAccount = account.replace(/^@+/, '');\n    const data = { account: normalizedAccount };\n\n    try {\n      await makeRequest(url, data);\n      setVerifyingCode(true);\n    } catch (e) {\n      console.error(e);\n      setErrorMessage(e);\n    }\n    setLoading(false);\n  };\n\n  const inputCodeStep = (\n    <div>\n      Paste in the code that was sent to your Fediverse account. If you did not receive a code, make\n      sure you can accept direct messages.\n      <div className={styles.codeInputContainer}>\n        <Input\n          value={code}\n          onChange={e => setCode(e.target.value)}\n          className={styles.codeInput}\n          placeholder=\"123456\"\n          maxLength={6}\n        />\n        <Button\n          type=\"primary\"\n          onClick={submitCodePressed}\n          disabled={code.length < 6}\n          className={styles.submitButton}\n        >\n          Verify Code\n        </Button>\n      </div>\n    </div>\n  );\n\n  const inputAccountStep = (\n    <>\n      <div>Your Fediverse Account</div>\n      <Input.Search\n        addonBefore=\"@\"\n        onInput={onInput}\n        value={account}\n        placeholder=\"youraccount@yourserver.com\"\n        status={!valid && account.length > 0 ? 'error' : undefined}\n        onSearch={submitAccountPressed}\n        enterButton={\n          <Button type={valid ? 'primary' : 'default'} disabled={!valid || account.length === 0}>\n            <CheckCircleOutlined />\n          </Button>\n        }\n      />\n    </>\n  );\n\n  return (\n    <Spin spinning={loading}>\n      <Space direction=\"vertical\">\n        {message}\n        {errorMessageText && (\n          <Alert message=\"Error\" description={errorMessageText} type=\"error\" showIcon />\n        )}\n        {verifyingCode ? inputCodeStep : inputAccountStep}\n        <Collapse ghost>\n          <Panel\n            key=\"header\"\n            header=\"Learn more about using the Fediverse to authenticate with chat.\"\n          >\n            <p>\n              You can link your chat identity with your Fediverse identity. Next time you want to\n              use this chat identity you can again go through the Fediverse authentication.\n            </p>\n          </Panel>\n        </Collapse>\n        <div>\n          <strong>Note</strong>: This is for authentication purposes only, and no personal\n          information will be accessed or stored.\n        </div>\n      </Space>\n    </Spin>\n  );\n};\n","export default {\"src\":\"/_next/static/media/indieauth.38c52a3d.png\",\"height\":512,\"width\":406,\"blurDataURL\":\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAICAMAAADtGH4KAAAAJFBMVEU4ODg4ODg5OTk5OTk5OTk4ODg5OTk4ODg5OTk5OTk5OTk4ODiRUFfYAAAAC3RSTlMCFOuovTv1zI8wabTrOYwAAAAJcEhZcwAALiMAAC4jAXilP3YAAAAsSURBVHicBcGFAQAwDMCg1Gb5/98BHG1gd2UQGeQwVvl4ujyUEzbbi8nyhn4bVgEfoFU38wAAAABJRU5ErkJggg==\",\"blurWidth\":6,\"blurHeight\":8};","import { Tabs } from 'antd';\nimport { useRecoilValue } from 'recoil';\nimport { FC } from 'react';\nimport { IndieAuthModal } from '../IndieAuthModal/IndieAuthModal';\nimport { FediAuthModal } from '../FediAuthModal/FediAuthModal';\n\nimport FediverseIcon from '../../../assets/images/fediverse-black.png';\nimport IndieAuthIcon from '../../../assets/images/indieauth.png';\n\nimport styles from './AuthModal.module.scss';\nimport {\n  currentUserAtom,\n  chatAuthenticatedAtom,\n  accessTokenAtom,\n  clientConfigStateAtom,\n} from '../../stores/ClientConfigStore';\nimport { ClientConfig } from '../../../interfaces/client-config.model';\n\nexport type AuthModalProps = {\n  forceTabs?: boolean;\n};\n\nexport const AuthModal: FC<AuthModalProps> = ({ forceTabs }) => {\n  const authenticated = useRecoilValue<boolean>(chatAuthenticatedAtom);\n  const accessToken = useRecoilValue<string>(accessTokenAtom);\n  const currentUser = useRecoilValue(currentUserAtom);\n  const clientConfig = useRecoilValue<ClientConfig>(clientConfigStateAtom);\n\n  if (!currentUser) {\n    return null;\n  }\n  const { displayName } = currentUser;\n  const { federation } = clientConfig;\n  const { enabled: fediverseEnabled } = federation;\n\n  const indieAuthTabTitle = (\n    <span className={styles.tabContent}>\n      <img className={styles.icon} src={IndieAuthIcon.src} alt=\"IndieAuth\" />\n      IndieAuth\n    </span>\n  );\n\n  const indieAuthTab = (\n    <IndieAuthModal\n      authenticated={authenticated}\n      displayName={displayName}\n      accessToken={accessToken}\n    />\n  );\n\n  const fediAuthTabTitle = (\n    <span className={styles.tabContent}>\n      <img className={styles.icon} src={FediverseIcon.src} alt=\"Fediverse auth\" />\n      FediAuth\n    </span>\n  );\n\n  const fediAuthTab = (\n    <FediAuthModal\n      authenticated={authenticated}\n      displayName={displayName}\n      accessToken={accessToken}\n    />\n  );\n\n  const items = [\n    { label: indieAuthTabTitle, key: '1', children: indieAuthTab },\n    { label: fediAuthTabTitle, key: '2', children: fediAuthTab },\n  ];\n\n  return (\n    <div>\n      <Tabs\n        defaultActiveKey=\"1\"\n        items={items}\n        type=\"card\"\n        size=\"small\"\n        renderTabBar={fediverseEnabled || forceTabs ? null : () => null}\n      />\n    </div>\n  );\n};\n","// to use with <input type=\"url\"> fields, as the default pattern only checks for `:`,\nexport const DEFAULT_TEXTFIELD_URL_PATTERN = 'https?://.*';\n\n/**\n * Determines if a URL is valid\n * @param {string} url - A URL to validate.\n * @param {string[]} validProtocols - An array of valid protocols. Defaults to web.\n * @returns {boolean} - True if the URI is valid, false otherwise.\n */\nexport function isValidUrl(url: string, validProtocols: string[] = ['http:', 'https:']): boolean {\n  try {\n    const validationObject = new URL(url);\n\n    if (\n      validationObject.protocol === '' ||\n      validationObject.hostname === '' ||\n      !validProtocols.includes(validationObject.protocol)\n    ) {\n      return false;\n    }\n  } catch (e) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Determines if an account is valid by simply checking for a protocol, username\n * and server, delimited by a colon. For example: @username:example.com\n * @param {string} account - An account to validate.\n * @param {string} protocol - The protocol we expect the account to be using.\n * @returns {boolean} - True if the account is valid, false otherwise.\n */\nexport function isValidAccount(account: string, protocol: string): boolean {\n  if (account.startsWith('@')) {\n    // eslint-disable-next-line no-param-reassign\n    account = account.slice(1);\n  }\n\n  const components = account.split(/:|@/);\n  const [service, user, host] = components;\n\n  console.log({ account, protocol, service, user, host });\n  if (service !== protocol) {\n    return false;\n  }\n\n  if (components.length !== 3 || !service || !user || !host) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Determines if an account is valid by simply checking for a protocol, username\n * and server, delimited by a colon. For example: @username:example.com\n * @param {string} account - An account to validate.\n * @returns {boolean} - True if the account is valid, false otherwise.\n */\nexport function isValidMatrixAccount(account: string): boolean {\n  if (account.startsWith('matrix:')) {\n    // eslint-disable-next-line no-param-reassign\n    account = account.slice(7);\n  } else {\n    return false;\n  }\n\n  if (account.startsWith('@')) {\n    // eslint-disable-next-line no-param-reassign\n    account = account.slice(1);\n  }\n\n  const components = account.split(':');\n  const [user, host] = components;\n\n  if (components.length !== 2 || !user || !host) {\n    return false;\n  }\n\n  return true;\n}\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"tabContent\":\"AuthModal_tabContent__KgMU3\",\"icon\":\"AuthModal_icon__kpEuV\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"codeInputContainer\":\"FediAuthModal_codeInputContainer__M_dAD\",\"codeInput\":\"FediAuthModal_codeInput__dIE6u\",\"submitButton\":\"FediAuthModal_submitButton__iuF9R\"};"],"names":["__webpack_exports__","Panel","Collapse","Link","Typography","IndieAuthModal","authenticated","displayName","username","accessToken","param","errorMessage","setErrorMessage","useState","loading","setLoading","valid","setValid","host","setHost","message","jsx_runtime","jsxs","span","jsx","b","errorMessageText","includes","validate","isValidUrl","url","onInput","char","e","nativeEvent","data","target","value","h","concat","submitButtonPressed","rawResponse","fetch","method","headers","Accept","body","JSON","stringify","authHost","content","json","redirect","window","location","Spin","spinning","Space","direction","Alert","description","type","showIcon","div","Input","addonBefore","placeholder","status","length","undefined","onSearch","enterButton","Button","disabled","CheckCircleOutlined","ghost","header","p","href","strong","FediAuthModal","account","setAccount","code","setCode","verifyingCode","setVerifyingCode","validateAccount","a","replace","regex","test","String","toLowerCase","acct","makeRequest","submitCodePressed","console","error","submitAccountPressed","normalizedAccount","inputCodeStep","className","styles","onChange","maxLength","onClick","inputAccountStep","Fragment","indieauth","AuthModal","forceTabs","useRecoilValue","chatAuthenticatedAtom","accessTokenAtom","currentUser","currentUserAtom","clientConfig","clientConfigStateAtom","federation","enabled","fediverseEnabled","indieAuthTabTitle","img","src","IndieAuthIcon","alt","indieAuthTab","fediAuthTabTitle","FediverseIcon","fediAuthTab","Tabs","defaultActiveKey","items","label","key","children","size","renderTabBar","DEFAULT_TEXTFIELD_URL_PATTERN","validProtocols","validationObject","URL","protocol","hostname","isValidAccount","startsWith","slice","components","split","service","user","log","isValidMatrixAccount","module","exports"],"sourceRoot":""}