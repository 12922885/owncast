(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5774],{56924:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var r,s,a,o,i,c=n(85893),u=n(71577),l=n(9764),d=n(67294),h=n(36531),m=n(66017),p=n(11622),f=n(13545),x=n.n(f),g=n(52196),v=n(93174),j=n.n(v);function _(){return _=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_.apply(this,arguments)}var y=function(e){return d.createElement("svg",_({height:500,viewBox:"0 0 132.292 132.292",width:500,xmlns:"http://www.w3.org/2000/svg"},e),r||(r=d.createElement("linearGradient",{id:"moderator_svg__a",gradientUnits:"userSpaceOnUse",x1:432.851,x2:464.644,y1:49.977,y2:49.977},d.createElement("stop",{offset:0,stopColor:"#2087e2"}),d.createElement("stop",{offset:1,stopColor:"#b63fff"}))),s||(s=d.createElement("path",{d:"M438.672 34.08h20.151a5.82 5.82 45 0 1 5.82 5.821v20.151a5.82 5.82 135 0 1-5.82 5.821h-20.15a5.82 5.82 45 0 1-5.822-5.82V39.9a5.82 5.82 135 0 1 5.821-5.82z",fill:"url(#moderator_svg__a)",transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})),a||(a=d.createElement("path",{d:"M121.11 29.551c-6.93 47.444-30.074 104.618-77.642 79.674l25.83 23.067h38.772c13.377 0 24.22-10.845 24.22-24.222V40.864z",fill:"#1d1535",fillOpacity:.335})),o||(o=d.createElement("path",{d:"M66.775 13.257s-7.129 57.999-.63 99.312c6.565 41.724-81.568-74.394-49.619-79.203 31.949-4.809 50.249-20.11 50.249-20.11z",fill:"#e2e8f0",fillOpacity:.306})),i||(i=d.createElement("path",{d:"M435.995 42.072c6.797.447 12.753-4.806 12.753-4.806s5.955 5.253 12.752 4.806c-.581 12.745-7.495 20.586-12.752 20.628-5.188.042-12.172-7.883-12.753-20.628z",fill:"none",stroke:"#fff",strokeLinejoin:"round",strokeWidth:2,transform:"matrix(4.16112 0 0 4.16112 -1801.146 -141.814)"})))};function C(){return(0,c.jsxs)("div",{className:j().chatModerationNotification,children:[(0,c.jsx)(y,{className:j().icon}),"You are now a moderator."]})}var w=n(47049),M=n(31681),b=n.n(M);function N(e){var t=e.message,n=e.highlightString,r=t.body,s=t.user.displayName;return(0,c.jsxs)("div",{className:b().chatSystemMessage,children:[(0,c.jsx)("div",{className:b().user,children:(0,c.jsx)("span",{className:b().userName,children:s})}),(0,c.jsx)(w.y,{search:n,children:(0,c.jsx)("div",{className:b().message,dangerouslySetInnerHTML:{__html:r}})})]})}var k=n(83066),Z=n.n(k),S=n(42827);function T(e){var t=e.isAuthorModerator,n=e.userColor,r=e.displayName,s="var(--theme-user-colors-".concat(n,")");return(0,c.jsxs)("div",{className:Z().join,children:[(0,c.jsxs)("span",{style:{color:s},children:[r,t&&(0,c.jsx)("span",{children:(0,c.jsx)(S.Z,{badge:"mod",userColor:n})})]})," ","joined the chat."]})}function E(e){var t=e.messages,n=e.usernameToHighlight,r=e.chatUserId,s=e.isModerator,a=e.showInput,o=e.height,i=(0,d.useState)(!1),f=i[0],v=i[1],j=(0,d.useRef)(null),_=function(e,a){switch(a.type){case p.C.CHAT:var o,i,u;return(0,c.jsx)(g.AO,{message:a,showModeratorMenu:s,highlightString:n,sentBySelf:(null===(o=a.user)||void 0===o?void 0:o.id)===r,sameUserAsLast:U(t,e),isAuthorModerator:null===(i=a.user.scopes)||void 0===i?void 0:i.includes("MODERATOR"),isAuthorAuthenticated:null===(u=a.user)||void 0===u?void 0:u.authenticated},a.id);case p.C.NAME_CHANGE:return function(e){var t=e.oldName,n=e.user,r=n.displayName,s=n.displayColor,a="var(--theme-color-users-".concat(s,")");return(0,c.jsxs)("div",{className:x().nameChangeView,children:[(0,c.jsx)("div",{style:{marginRight:5,height:"max-content",margin:"auto 5px auto 0"},children:(0,c.jsx)(h.Z,{})}),(0,c.jsxs)("div",{className:x().nameChangeText,children:[(0,c.jsx)("span",{style:{color:a},children:t}),(0,c.jsx)("span",{className:x().plain,children:" is now known as "}),(0,c.jsx)("span",{style:{color:a},children:r})]})]})}(a);case p.C.CONNECTED_USER_INFO:return function(e){if(!B(e))return(0,c.jsx)("div",{style:{width:"1px",height:"1px"}});return(0,c.jsx)(C,{})}(a);case p.C.USER_JOINED:return function(e){var t=e.user,n=t.displayName,r=t.displayColor,s=B(e);return(0,c.jsx)(T,{displayName:n,userColor:r,isAuthorModerator:s})}(a);case p.C.SYSTEM:return(0,c.jsx)(N,{message:a,highlightString:n},a.id);default:return null}},y=(0,d.useMemo)((function(){return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(l.OO,{style:{height:o,width:"auto"},ref:j,initialTopMostItemIndex:t.length-1,data:t,itemContent:function(e,t){return _(e,t)},followOutput:"auto",alignToBottom:!0,atBottomStateChange:function(e){return v(e)}}),!f&&(0,c.jsx)("div",{className:x().toBottomWrap,children:(0,c.jsx)(u.Z,{type:"default",icon:(0,c.jsx)(m.Z,{}),onClick:function(){return j.current.scrollToIndex({index:t.length-1,behavior:"smooth"})},children:"Go to last message"})})]})}),[t,n,r,s,f]);return(0,c.jsxs)("div",{style:{height:"100%"},children:[y,a&&(0,c.jsx)(g.xu,{})]})}function U(e,t){if(e.length<2)return!1;var n=e[t],r=n.user.id,s=e[t-1];if((null===s||void 0===s?void 0:s.type)!==p.C.CHAT)return!1;if(!s.timestamp||!n.timestamp)return!1;var a=new Date(s.timestamp).getTime();return!(new Date(n.timestamp).getTime()-a>12e4)&&r===(null===s||void 0===s?void 0:s.user.id)}function B(e){var t=e.user.scopes;return!(!t||0===t.length)&&t.includes("MODERATOR")}E.defaultProps={showInput:!0,height:"calc(100vh - 170px)"}},42827:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(85893),s=(n(67294),n(79010)),a=n.n(s);function o(e){var t=e.badge,n=e.userColor,s="var(--theme-user-colors-".concat(n,")"),o={color:s,borderColor:s};return(0,r.jsx)("span",{style:o,className:a().badge,children:t})}},52196:function(e,t,n){"use strict";n.d(t,{uU:function(){return r.Z},xu:function(){return he},AO:function(){return q}});var r=n(56924),s=n(14924),a=n(85893),o=n(67294),i=n(47049),c=n(86492),u=n.n(c),l=n(94184),d=n.n(l),h=n(94199),m=n(29158),p=n(4480),f=n(78583),x=n.n(f);function g(e){var t=new Date(e);if(Number.isNaN(t))return"";if(function(e){var t="string"===typeof e?new Date(e):e;return(new Date-t)/864e5}(e)>=1){var n=t.toLocaleDateString("en-US",{dateStyle:"medium"});return"at ".concat(n," at ").concat(t.toLocaleTimeString())}return"".concat(t.toLocaleTimeString())}var v=n(47568),j=n(34051),_=n.n(j),y=n(11475),C=n(90420),w=n(18429),M=n(64942),b=n(85402),N=n(12461),k=n(66516),Z=n(38504),S=n(26713),T=n(25968),E=n(6226),U=n(71577),B=n(11382),A=n(51438),O=function(){function e(){(0,A.Z)(this,e)}return e.removeMessage=function(e,t){return(0,v.Z)(_().mark((function n(){var r,s,a;return _().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=new URL("/api/chat/messagevisibility",window.location.toString())).searchParams.append("accessToken",t),s=r.toString(),a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idArray:[e]})},n.next=6,fetch(s,a);case 6:case"end":return n.stop()}}),n)})))()},e.banUser=function(e,t){return(0,v.Z)(_().mark((function n(){var r,s,a;return _().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return(r=new URL("/api/chat/users/setenabled",window.location.toString())).searchParams.append("accessToken",t),s=r.toString(),a={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})},n.next=6,fetch(s,a);case 6:case"end":return n.stop()}}),n)})))()},e}(),D=n(62638),I=n.n(D),P=function(){var e=(0,v.Z)(_().mark((function e(t,n){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{O.removeMessage(t,n)}catch(r){console.error(r)}case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),R=function(e){var t=e.label,n=e.value;return(0,a.jsxs)(T.Z,{justify:"space-around",align:"middle",children:[(0,a.jsx)(E.Z,{span:12,children:t}),(0,a.jsx)(E.Z,{span:12,children:n})]})},F=function(e){var t=e.id,n=e.body,r=e.accessToken;return(0,a.jsxs)(T.Z,{justify:"space-around",align:"middle",children:[(0,a.jsx)(E.Z,{span:18,children:n}),(0,a.jsx)(E.Z,{children:(0,a.jsx)(U.Z,{onClick:function(){return P(t,r)},children:"X"})})]})},H=function(e){var t=e.client,n=t.messageCount,r=t.userAgent,s=t.connectedAt,o=t.geo;return(0,a.jsxs)("div",{children:[(0,a.jsx)(R,{label:"Messages Sent",value:"".concat(n)}),(0,a.jsx)(R,{label:"Geo",value:o}),(0,a.jsx)(R,{label:"Connected At",value:s.toString()}),(0,a.jsx)(R,{label:"User Agent",value:r})]})},L=function(e){var t=e.color,n="var(--theme-color-users-".concat(t,")");return(0,a.jsxs)(T.Z,{justify:"space-around",align:"middle",children:[(0,a.jsx)(E.Z,{span:12,children:"Color"}),(0,a.jsx)(E.Z,{span:12,children:(0,a.jsx)("div",{className:I().colorBlock,style:{backgroundColor:n},children:t})})]})};function W(e){var t=e.userId,n=e.accessToken,r=(0,o.useState)(null),s=r[0],i=r[1],c=(0,o.useState)(!0),u=c[0],l=c[1],d=function(){var e=(0,v.Z)(_().mark((function e(){var n;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/moderation/chat/user/".concat(t));case 3:return e.next=5,e.sent.json();case 5:n=e.sent,i(n),l(!1),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();if((0,o.useEffect)((function(){d()}),[]),!s)return null;var h=s.user,m=s.connectedClients,p=s.messages,f=h.displayName,x=h.displayColor,g=h.createdAt,j=h.previousNames,y=h.scopes,C=h.isBot,w=h.authenticated;return(0,a.jsx)("div",{className:I().modalContainer,children:(0,a.jsxs)(B.Z,{spinning:u,children:[(0,a.jsx)("h1",{children:f}),(0,a.jsxs)(T.Z,{justify:"space-around",align:"middle",children:[y.map((function(e){return(0,a.jsx)(E.Z,{children:e})})),w&&(0,a.jsx)(E.Z,{children:"Authenticated"}),C&&(0,a.jsx)(E.Z,{children:"Bot"})]}),(0,a.jsx)(L,{color:x}),(0,a.jsx)(R,{label:"User Created",value:g.toString()}),(0,a.jsx)(R,{label:"Previous Names",value:j.join(",")}),(0,a.jsx)("hr",{}),(0,a.jsx)("h2",{children:"Currently Connected"}),m.length>0&&(0,a.jsx)(T.Z,{gutter:[15,15],wrap:!0,children:m.map((function(e){return(0,a.jsx)(E.Z,{flex:"auto",children:(0,a.jsx)(H,{client:e})})}))}),(0,a.jsx)("hr",{}),p.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{children:"Recent Chat Messages"}),(0,a.jsx)("div",{className:I().chatHistory,children:p.map((function(e){return(0,a.jsx)(F,{id:e.id,body:e.body,accessToken:n},e.id)}))})]})]})})}var J=n(31833),V=n.n(J),Y=b.Z.confirm;function z(e){var t=e.messageID,n=e.userID,r=e.userDisplayName,s=e.accessToken,i=(0,o.useState)(!1),c=i[0],u=i[1],l=function(){var e=(0,v.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.banUser(n,s);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),N.ZP.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),d=function(){var e=(0,v.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.removeMessage(t,s);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),N.ZP.error(e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),h=function(){var e=(0,v.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Y({icon:(0,a.jsx)(y.Z,{}),content:"Are you sure you want to remove this message from ".concat(r,"?"),onOk:function(){d()}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),m=function(){var e=(0,v.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Y({icon:(0,a.jsx)(y.Z,{}),content:"Are you sure you want to ban ".concat(r," from chat?"),onOk:function(){l()}});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=(0,a.jsx)(k.Z,{onClick:function(e){var t=e.key;"hide-message"===t?h():"ban-user"===t?m():"more-info"===t&&u(!0)},items:[{label:(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:V().icon,children:(0,a.jsx)(C.Z,{})}),"Hide Message"]}),key:"hide-message"},{label:(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:V().icon,children:(0,a.jsx)(w.Z,{})}),"Ban User"]}),key:"ban-user"},{label:(0,a.jsx)("div",{children:"More Info..."}),key:"more-info"}]});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{overlay:p,trigger:["click"],children:(0,a.jsx)("button",{type:"button",onClick:function(e){return e.preventDefault()},children:(0,a.jsx)(S.Z,{children:(0,a.jsx)(M.Z,{})})})}),(0,a.jsx)(b.Z,{visible:c,okText:"Ban User",okButtonProps:{danger:!0},onOk:l,onCancel:function(){u(!1)},children:(0,a.jsx)(W,{userId:n,accessToken:s})})]})}var G=n(42827),X=n(39370);function q(e){var t=e.message,n=e.highlightString,r=e.showModeratorMenu,c=e.sentBySelf,l=e.sameUserAsLast,f=e.isAuthorModerator,v=e.isAuthorAuthenticated,j=t.id,_=t.body,y=t.user,C=t.timestamp,w=y.id,M=y.displayName,b=y.displayColor,N=(0,p.sJ)(X.FI),k="var(--theme-color-users-".concat(b,")"),Z="Sent ".concat(g(C)),S=(0,o.useState)(_),T=S[0],E=S[1],U=[];return f&&U.push((0,a.jsx)(G.Z,{badge:"mod",userColor:b},"mod")),v&&U.push((0,a.jsx)(G.Z,{badge:(0,a.jsx)(m.Z,{title:"authenticated"}),userColor:b},"auth")),(0,o.useEffect)((function(){E(u().decode(_))}),[t]),(0,a.jsx)("div",{className:d()(x().messagePadding,l&&x().messagePaddingCollapsed),children:(0,a.jsxs)("div",{className:d()(x().root,(0,s.Z)({},x().ownMessage,c)),style:{borderColor:k},children:[!l&&(0,a.jsx)(h.Z,{title:"user info goes here",placement:"topLeft",mouseEnterDelay:1,children:(0,a.jsxs)("div",{className:x().user,style:{color:k},children:[(0,a.jsx)("span",{className:x().userName,children:M}),(0,a.jsx)("span",{children:U})]})}),(0,a.jsx)(h.Z,{title:Z,mouseEnterDelay:1,children:(0,a.jsx)(i.y,{search:n,children:(0,a.jsx)("div",{className:x().message,dangerouslySetInnerHTML:{__html:T}})})}),r&&(0,a.jsx)("div",{className:x().modMenuWrapper,children:(0,a.jsx)(z,{messageID:j,accessToken:N,userID:w,userDisplayName:M})}),(0,a.jsx)("div",{className:x().customBorder,style:{color:k}}),(0,a.jsx)("div",{className:x().background,style:{color:k}})]})})}var K=n(26042),Q=n(69396),$=n(93045),ee=n(27496),te=n(55241),ne=n(77493),re=n(96391),se=n(57741);function ae(e){var t=(0,o.useState)([]),n=t[0],r=t[1],s=e.onEmojiSelect,i=(0,o.useRef)(),c=function(){var e=(0,v.Z)(_().mark((function e(){var t,n;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("/api/emoji");case 3:return t=e.sent,e.next=6,t.json();case 6:n=e.sent,r(n),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("cannot fetch custom emoji",e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();return(0,o.useEffect)((function(){c()}),[]),(0,o.useEffect)((function(){(0,se.wU)({rootElement:i.current,custom:n}).addEventListener("emoji:select",(function(e){console.log("Emoji selected:",e.emoji),s(e)}))}),[n]),(0,a.jsx)("div",{ref:i})}var oe=n(11622),ie=n(25882),ce=n.n(ie),ue=function(e){var t=e.element;return(0,a.jsx)("img",{src:t.url,alt:"emoji",style:{display:"inline",position:"relative",width:"30px",bottom:"10px"}})},le=function(e){var t=e.attributes,n=e.children;return"image"===e.element.type?(0,a.jsx)(ue,(0,K.Z)({},e)):(0,a.jsx)("p",(0,Q.Z)((0,K.Z)({},t),{children:n}))},de=function(e){if(ne.xv.isText(e))return e.text;var t=e.children.map((function(e){return de(e)})).join("");switch(e.type){case"paragraph":return"<p>".concat(t,"</p>");case"image":return'<img src="'.concat(e.url,'" alt="emoji" />');default:return t}};function he(e){var t=(0,o.useState)(!1),n=t[0],r=t[1],s=(0,p.sJ)(X.Gt),i=(0,o.useState)((function(){return function(e){var t=e.isVoid;return e.isVoid=function(e){return"image"===e.type||t(e)},e.isInline=function(e){return"image"===e.type},e}((0,re.BU)((0,ne.Jh)()))})),c=i[0],u=function(){if(s){var e=de(c);s.send({type:oe.C.CHAT,body:e}),ne.YR.select(c,[0,c.children.length-1]),ne.YR.delete(c)}else console.log("websocketService is not defined")};return(0,a.jsx)("div",{children:(0,a.jsxs)("div",{className:ce().root,children:[(0,a.jsxs)(re.mH,{editor:c,value:[{type:"paragraph",children:[{text:""}]}],onChange:function(){},children:[(0,a.jsx)(re.CX,{onKeyDown:function(e){"Enter"===e.key&&(e.preventDefault(),u())},renderElement:function(e){return(0,a.jsx)(le,(0,K.Z)({},e))},placeholder:"Chat message goes here...",style:{width:"100%"},autoFocus:!0}),(0,a.jsx)(te.Z,{content:(0,a.jsx)(ae,{onEmojiSelect:function(e){if(re.F3.focus(c),e.url)e.url;else{var t=e.emoji;ne.YR.insertText(c,t)}}}),trigger:"click",onVisibleChange:function(e){return r(e)},visible:n})]}),(0,a.jsx)("button",{type:"button",className:ce().emojiButton,title:"Emoji picker button",onClick:function(){return r(!n)},children:(0,a.jsx)($.Z,{})}),(0,a.jsx)(U.Z,{className:ce().sendButton,size:"large",type:"ghost",icon:(0,a.jsx)(ee.Z,{}),onClick:u})]})})}he.defaultProps={value:""}},13545:function(e){e.exports={chatHeader:"ChatContainer_chatHeader__EJsYI",toBottomWrap:"ChatContainer_toBottomWrap__3V5wa",nameChangeView:"ChatContainer_nameChangeView__ziyXN",nameChangeText:"ChatContainer_nameChangeText__yXG__",plain:"ChatContainer_plain__IPS19"}},83066:function(e){e.exports={join:"ChatJoinMessage_join__fP0IQ"}},31833:function(e){e.exports={icon:"ChatModerationActionMenu_icon__9j6DF"}},62638:function(e){e.exports={modalContainer:"ChatModerationDetailsModal_modalContainer__czndV",chatHistory:"ChatModerationDetailsModal_chatHistory__PunRk",colorBlock:"ChatModerationDetailsModal_colorBlock___rAlw"}},93174:function(e){e.exports={chatModerationNotification:"ChatModeratorNotification_chatModerationNotification__kgFWe",icon:"ChatModeratorNotification_icon__7FdGg"}},31681:function(e){e.exports={chatSystemMessage:"ChatSystemMessage_chatSystemMessage__c6XEN",user:"ChatSystemMessage_user__6yHSJ",message:"ChatSystemMessage_message__ySq5g"}},25882:function(e){e.exports={root:"ChatTextField_root__4oUkJ",inputWrapper:"ChatTextField_inputWrapper__qBEWv",submitButtonWrapper:"ChatTextField_submitButtonWrapper__YBPMe",sendButton:"ChatTextField_sendButton__MOmD4",emojiButton:"ChatTextField_emojiButton__ON_Cu"}},79010:function(e){e.exports={badge:"ChatUserBadge_badge__1EdUp"}},78583:function(e){e.exports={root:"ChatUserMessage_root__79heB",user:"ChatUserMessage_user__xUEp9",message:"ChatUserMessage_message__MJ9LD",customBorder:"ChatUserMessage_customBorder__YudkU",ownMessage:"ChatUserMessage_ownMessage__d28A3",background:"ChatUserMessage_background__Tfghp",modMenuWrapper:"ChatUserMessage_modMenuWrapper__7fblv",messagePadding:"ChatUserMessage_messagePadding__Xp1F6",messagePaddingCollapsed:"ChatUserMessage_messagePaddingCollapsed__qxN0E"}}}]);