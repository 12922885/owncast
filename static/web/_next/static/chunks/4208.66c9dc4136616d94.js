(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4208],{22825:function(e,t){"use strict";t.Z={src:"/_next/static/media/fediverse-black.0b51c805.png",height:100,width:100,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAMAAADz0U65AAAAOVBMVEVMaXEbGxsREREQEBAPDw8NDQ0FBQUQEBAQEBAUFBQNDQ0REREVFRUQEBAODg4UFBQUFBQHBwcNDQ1DUQGwAAAAE3RSTlMAC2QvWeDEnZQbSn15tW2ri/pAr8wTOgAAAAlwSFlzAAALEwAACxMBAJqcGAAAAD1JREFUeJwdy0cOgDAMAMGNS2yHFPj/Z0GcRwMwegNaWbgB3WfmZSArZd7eqR0qEYM6GT/pc/bygqal8v0XMgEBhHcrytIAAAAASUVORK5CYII=",blurWidth:8,blurHeight:8}},44208:function(e,t,n){"use strict";n.r(t),n.d(t,{AuthModal:function(){return E}});var s=n(85893),a=n(90575),i=n(4480),r=n(8751),o=n(54907),c=n(6880),d=n(11382),u=n(26713),l=n(14670),h=n(69677),p=n(71577),A=n(67294),y=n(37174);const{Panel:g}=o.Z,{Link:f}=c.Z,v=e=>{let{authenticated:t,displayName:n,accessToken:a}=e;const[i,c]=(0,A.useState)(null),[v,m]=(0,A.useState)(!1),[x,j]=(0,A.useState)(!1),[w,b]=(0,A.useState)(""),Z=t?(0,s.jsxs)("span",{children:[(0,s.jsx)("b",{children:"You are already authenticated"}),". However, you can add other domains or log in as a different user."]}):(0,s.jsxs)("span",{children:["Use your own domain to authenticate ",(0,s.jsx)("span",{children:n})," or login as a previously"," ","authenticated chat user using IndieAuth."]});let I=i;I&&I.includes("url does not support indieauth")&&(I="The provided URL is either invalid or does not support IndieAuth.");return(0,s.jsx)(d.Z,{spinning:v,children:(0,s.jsxs)(u.Z,{direction:"vertical",children:[Z,I&&(0,s.jsx)(l.Z,{message:"Error",description:I,type:"error",showIcon:!0}),(0,s.jsx)("div",{children:"Your domain"}),(0,s.jsx)(h.Z.Search,{addonBefore:"https://",onInput:e=>{if(":"===e.nativeEvent.data)return;b(e.target.value);const t="https://".concat(e.target.value);var n;n=t,(0,y.jv)(n)&&n.includes(".")?j(!0):j(!1)},type:"url",value:w,placeholder:"yoursite.com",status:!x&&w.length>0?"error":void 0,onSearch:async()=>{if(x){m(!0);try{const e="/api/auth/indieauth?accessToken=".concat(a),t={authHost:"https://".concat(w)},n=await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}),s=await n.json();if(s.message)return c(s.message),void m(!1);if(!s.redirect)return c("Auth provider did not return a redirect URL."),void m(!1);if(s.redirect){const{redirect:e}=s;window.location=e}}catch(e){c(e.message)}m(!1)}},enterButton:(0,s.jsx)(p.Z,{type:x?"primary":"default",disabled:!x||0===w.length,children:(0,s.jsx)(r.Z,{})})}),(0,s.jsx)(o.Z,{ghost:!0,children:(0,s.jsxs)(g,{header:"Learn more about using IndieAuth to authenticate with chat.",children:[(0,s.jsx)("p",{children:"IndieAuth allows for a completely independent and decentralized way of identifying yourself using your own domain."}),(0,s.jsxs)("p",{children:["If you run an Owncast instance, you can use that domain here. Otherwise,"," ",(0,s.jsx)(f,{href:"https://indieauth.net/#providers",children:"learn more about how you can support IndieAuth"}),"."]})]},"header")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Note"}),": This is for authentication purposes only, and no personal information will be accessed or stored."]})]})})};var m=n(50501),x=n.n(m);const{Panel:j}=o.Z,w=e=>{let{authenticated:t,displayName:n,accessToken:a}=e;const[i,c]=(0,A.useState)(null),[y,g]=(0,A.useState)(!1),[f,v]=(0,A.useState)(!1),[m,w]=(0,A.useState)(""),[b,Z]=(0,A.useState)(""),[I,S]=(0,A.useState)(!1),N=t?(0,s.jsxs)("span",{children:[(0,s.jsx)("b",{children:"You are already authenticated"}),". However, you can add other domains or log in as a different user."]}):(0,s.jsxs)("span",{children:["Receive a direct message on the Fediverse to link your account to"," ",(0,s.jsx)("strong",{children:n}),", or login as a previously linked chat user."]});let E=i;E&&E.includes("url does not support indieauth")&&(E="The provided URL is either invalid or does not support IndieAuth.");const B=e=>{v(function(e){const t=e.replace(/^@+/,"");return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())}(e))},F=async(e,t)=>{const n=await fetch(e,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(t)}),s=await n.json();s.message&&(c(s.message),g(!1))},_=(0,s.jsxs)("div",{children:["Paste in the code that was sent to your Fediverse account. If you did not receive a code, make sure you can accept direct messages.",(0,s.jsxs)("div",{className:x().codeInputContainer,children:[(0,s.jsx)(h.Z,{value:b,onChange:e=>Z(e.target.value),className:x().codeInput,placeholder:"123456",maxLength:6}),(0,s.jsx)(p.Z,{type:"primary",onClick:async()=>{g(!0);const e="/api/auth/fediverse/verify?accessToken=".concat(a),t={code:b};try{await F(e,t),window.location.href="/"}catch(n){console.error(n),c(n)}g(!1)},disabled:b.length<6,className:x().submitButton,children:"Verify Code"})]})]}),k=(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{children:"Your Fediverse Account"}),(0,s.jsx)(h.Z.Search,{addonBefore:"@",onInput:e=>{w(e.target.value),B(e.target.value)},value:m,placeholder:"youraccount@yourserver.com",status:!f&&m.length>0?"error":void 0,onSearch:async()=>{if(!f)return;g(!0),c(null);const e="/api/auth/fediverse?accessToken=".concat(a),t={account:m.replace(/^@+/,"")};try{await F(e,t),S(!0)}catch(n){console.error(n),c(n)}g(!1)},enterButton:(0,s.jsx)(p.Z,{type:f?"primary":"default",disabled:!f||0===m.length,children:(0,s.jsx)(r.Z,{})})})]});return(0,s.jsx)(d.Z,{spinning:y,children:(0,s.jsxs)(u.Z,{direction:"vertical",children:[N,E&&(0,s.jsx)(l.Z,{message:"Error",description:E,type:"error",showIcon:!0}),I?_:k,(0,s.jsx)(o.Z,{ghost:!0,children:(0,s.jsx)(j,{header:"Learn more about using the Fediverse to authenticate with chat.",children:(0,s.jsx)("p",{children:"You can link your chat identity with your Fediverse identity. Next time you want to use this chat identity you can again go through the Fediverse authentication."})},"header")}),(0,s.jsxs)("div",{children:[(0,s.jsx)("strong",{children:"Note"}),": This is for authentication purposes only, and no personal information will be accessed or stored."]})]})})};var b=n(22825),Z="/_next/static/media/indieauth.38c52a3d.png",I=n(54639),S=n.n(I),N=n(77466);const E=e=>{let{forceTabs:t}=e;const n=(0,i.sJ)(N.L4),r=(0,i.sJ)(N.FI),o=(0,i.sJ)(N.db),c=(0,i.sJ)(N.g1);if(!o)return null;const{displayName:d}=o,{federation:u}=c,{enabled:l}=u,h=[{label:(0,s.jsxs)("span",{className:S().tabContent,children:[(0,s.jsx)("img",{className:S().icon,src:Z,alt:"IndieAuth"}),"IndieAuth"]}),key:"1",children:(0,s.jsx)(v,{authenticated:n,displayName:d,accessToken:r})},{label:(0,s.jsxs)("span",{className:S().tabContent,children:[(0,s.jsx)("img",{className:S().icon,src:b.Z.src,alt:"Fediverse auth"}),"FediAuth"]}),key:"2",children:(0,s.jsx)(w,{authenticated:n,displayName:d,accessToken:r})}];return(0,s.jsx)("div",{children:(0,s.jsx)(a.Z,{defaultActiveKey:"1",items:h,type:"card",size:"small",renderTabBar:l||t?null:()=>null})})}},37174:function(e,t,n){"use strict";n.d(t,{Kf:function(){return i},ax:function(){return s},bu:function(){return r},jv:function(){return a}});const s="https?://.*";function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["http:","https:"];try{const n=new URL(e);if(""===n.protocol||""===n.hostname||!t.includes(n.protocol))return!1}catch(n){return!1}return!0}function i(e,t){e.startsWith("@")&&(e=e.slice(1));const n=e.split(/:|@/),[s,a,i]=n;return console.log({account:e,protocol:t,service:s,user:a,host:i}),s===t&&!!(3===n.length&&s&&a&&i)}function r(e){if(!e.startsWith("matrix:"))return!1;(e=e.slice(7)).startsWith("@")&&(e=e.slice(1));const t=e.split(":"),[n,s]=t;return!(2!==t.length||!n||!s)}},54639:function(e){e.exports={tabContent:"AuthModal_tabContent__KgMU3",icon:"AuthModal_icon__kpEuV"}},50501:function(e){e.exports={codeInputContainer:"FediAuthModal_codeInputContainer__M_dAD",codeInput:"FediAuthModal_codeInput__dIE6u",submitButton:"FediAuthModal_submitButton__iuF9R"}}}]);
//# sourceMappingURL=4208.66c9dc4136616d94.js.map