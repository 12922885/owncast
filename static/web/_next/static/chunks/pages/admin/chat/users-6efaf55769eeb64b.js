(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9522],{55583:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/users",function(){return n(40528)}])},94538:function(e,t,n){"use strict";n.d(t,{e:function(){return d}});var s=n(85893),r=n(85402),a=n(71577),o=n(21640),c=n(82911),i=n(84674),l=n(64777);const d=e=>{let{user:t,isEnabled:n,label:d,onClick:u}=e;const m=n?"ban":"unban",h=n?(0,s.jsx)(o.Z,{style:{color:"var(--ant-error)"}}):(0,s.jsx)(c.Z,{style:{color:"var(--ant-warning)"}}),p=(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to ",m," ",(0,s.jsx)("strong",{children:t.displayName}),n?" and remove their messages?":"?"]});return(0,s.jsx)(a.Z,{type:"primary",onClick:()=>{r.Z.confirm({title:"Confirm ".concat(m),content:p,onCancel:()=>{},onOk:()=>new Promise(((e,s)=>{const r=async function(e){let{id:t}=e;const s={userId:t,enabled:!n};try{return(await(0,l.rQ)(l.NM,{data:s,method:"POST",auth:!0})).success}catch(r){console.error(r)}return!1}(t);r?setTimeout((()=>{e(r),null===u||void 0===u||u()}),3e3):s()})),okType:"danger",okText:n?"Absolutely":null,icon:h})},size:"small",icon:n?(0,s.jsx)(i.Z,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:d||m})};d.defaultProps={label:"",onClick:null}},6491:function(e,t,n){"use strict";n.d(t,{Z:function(){return N}});var s=n(85893),r=n(67294),a=n(85402),o=n(6880),c=n(71230),i=n(15746),l=n(27049),d=n(26713),u=n(45938),m=n(58091),h=n(96486),p=n(5152),g=n.n(p),f=n(94538),y=n(71577),x=n(21640),b=n(82911),j=n(84674),v=n(24478),w=n(64777);const k=e=>{let{user:t,onClick:n}=e;var r;const o=null===(r=t.scopes)||void 0===r?void 0:r.includes("MODERATOR"),c=o?"remove moderator":"add moderator",i=o?(0,s.jsx)(x.Z,{style:{color:"var(--ant-error)"}}):(0,s.jsx)(b.Z,{style:{color:"var(--ant-warning)"}}),l=(0,s.jsxs)(s.Fragment,{children:["Are you sure you want to ",c," ",(0,s.jsx)("strong",{children:t.displayName}),"?"]});return(0,s.jsx)(y.Z,{type:"primary",onClick:()=>{a.Z.confirm({title:"Confirm ".concat(c),content:l,onCancel:()=>{},onOk:()=>new Promise(((e,s)=>{const r=async function(e,t){let{id:n}=e;const s={userId:n,isModerator:t};try{return(await(0,w.rQ)(w.jr,{data:s,method:"POST",auth:!0})).success}catch(r){console.error(r)}return!1}(t,!o);r?setTimeout((()=>{e(r),null===n||void 0===n||n()}),3e3):s()})),okType:"danger",okText:o?"Yup!":null,icon:i})},size:"small",icon:o?(0,s.jsx)(j.Z,{twoToneColor:"#ff4d4f"}):(0,s.jsx)(v.Z,{twoToneColor:"#22bb44"}),className:"block-user-button",children:c})};k.defaultProps={onClick:null};var C=n(45840),A=n(70241);const T=g()((()=>Promise.all([n.e(4885),n.e(9915),n.e(575),n.e(7910),n.e(428),n.e(7916),n.e(2918),n.e(8119),n.e(3859),n.e(6113),n.e(8900)]).then(n.bind(n,86113)).then((e=>e.Tooltip))),{loadableGenerated:{webpack:()=>[86113]},ssr:!1}),N=e=>{let{user:t,connectionInfo:n,children:p}=e;const[g,y]=(0,r.useState)(!1),x=()=>{y(!1)},{displayName:b,createdAt:j,previousNames:v,nameChangedAt:w,disabledAt:N}=t,{connectedAt:P,messageCount:Z,userAgent:S}=n||{};let D=null;const I=v&&[...v];v&&v.length>1&&w&&(D=new Date(w),I.reverse());const O=new Date(j),M=(0,m.Z)(O,"PP pp"),E=D?(0,u.Z)(D):null;return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(T,{title:(0,s.jsxs)(s.Fragment,{children:["Created at: ",M,".",(0,s.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,s.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:()=>{y(!0)},children:p})}),(0,s.jsx)(a.Z,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(b),open:g,onOk:x,onCancel:x,children:(0,s.jsxs)("div",{className:"user-details",children:[(0,s.jsx)(o.Z.Title,{level:4,children:b}),(0,s.jsxs)("p",{className:"created-at",children:["User created at ",M,"."]}),(0,s.jsxs)(c.Z,{gutter:16,children:[n&&(0,s.jsxs)(i.Z,{md:D?12:24,children:[(0,s.jsx)(o.Z.Title,{level:5,children:"This user is currently connected to Chat."}),(0,s.jsxs)("ul",{className:"connection-info",children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Active for:"})," ",(0,u.Z)(new Date(P))]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Messages sent:"})," ",Z]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"User Agent:"}),(0,s.jsx)("br",{}),(0,A.AB)(S)]})]})]}),D&&(0,s.jsxs)(i.Z,{md:n?12:24,children:[(0,s.jsx)(o.Z.Title,{level:5,children:"This user is also seen as:"}),(0,s.jsx)("ul",{className:"previous-names-list",children:(0,h.uniq)(I).map(((e,t)=>(0,s.jsxs)("li",{className:0===t?"latest":"",children:[(0,s.jsx)("span",{className:"user-name-item",children:e}),0===t?" (Changed ".concat(E," ago)"):""]})))})]})]}),(0,s.jsx)(l.Z,{}),(0,s.jsxs)(d.Z,{direction:"horizontal",children:[N?(0,s.jsxs)(s.Fragment,{children:["This user was banned on ",(0,s.jsx)("code",{children:(0,C.u)(N)}),".",(0,s.jsx)("br",{}),(0,s.jsx)("br",{}),(0,s.jsx)(f.e,{label:"Unban this user",user:t,isEnabled:!1,onClick:x})]}):(0,s.jsx)(f.e,{label:"Ban this user",user:t,isEnabled:!0,onClick:x}),(0,s.jsx)(k,{user:t,onClick:x})]})]})})]})};N.defaultProps={connectionInfo:null}},45840:function(e,t,n){"use strict";n.d(t,{K:function(){return l},u:function(){return i}});var s=n(85893),r=n(48213),a=n(58091),o=n(6491),c=n(94538);function i(e){return(0,a.Z)(new Date(e),"MMM d H:mma")}const l=e=>{let{data:t}=e;const n=[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(e,t)=>(0,s.jsx)(o.Z,{user:t,children:(0,s.jsx)("span",{className:"display-name",children:e})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>i(e),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:e=>e?i(e):null,sorter:(e,t)=>new Date(e.disabledAt).getTime()-new Date(t.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(c.e,{user:t,isEnabled:!t.disabledAt})}];return(0,s.jsx)(r.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:n,dataSource:t,size:"small",rowKey:"id"})}},40528:function(e,t,n){"use strict";n.r(t),n.d(t,{FETCH_INTERVAL:function(){return v},default:function(){return w}});var s=n(85893),r=n(67294),a=n(90575),o=n(99519),c=n(64777),i=n(45840),l=n(69677),d=n(48213),u=n(68795),m=n(45938),h=n(6491),p=n(94538),g=n(70241);const f=e=>{let{data:t}=e;const n=[{title:"Display Name",key:"username",render:e=>{const{user:t,connectedAt:n,messageCount:r,userAgent:a}=e,o={connectedAt:n,messageCount:r,userAgent:a};return(0,s.jsx)(h.Z,{user:t,connectionInfo:o,children:(0,s.jsx)("span",{className:"display-name",children:t.displayName})})},sorter:(e,t)=>t.user.displayName.localeCompare(e.user.displayName),filterIcon:(0,s.jsx)(u.Z,{}),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:n,confirm:r}=e;return(0,s.jsx)("div",{style:{padding:8},children:(0,s.jsx)(l.Z,{placeholder:"Search display names...",value:n[0],onChange:e=>{t(e.target.value?[e.target.value]:[]),r({closeDropdown:!1})}})})},onFilter:(e,t)=>t.user.displayName.includes(e),sortDirections:["descend","ascend"]},{title:"Messages sent",dataIndex:"messageCount",key:"messageCount",className:"number-col",width:"12%",sorter:(e,t)=>e.messageCount-t.messageCount,sortDirections:["descend","ascend"],render:e=>(0,s.jsx)("div",{style:{textAlign:"center"},children:e})},{title:"Connected Time",dataIndex:"connectedAt",key:"connectedAt",defaultSortOrder:"ascend",render:e=>(0,m.Z)(new Date(e)),sorter:(e,t)=>new Date(t.connectedAt).getTime()-new Date(e.connectedAt).getTime(),sortDirections:["descend","ascend"]},{title:"User Agent",dataIndex:"userAgent",key:"userAgent",render:e=>(0,g.AB)(e)},{title:"Location",dataIndex:"geo",key:"geo",render:e=>e?"".concat(e.regionName,", ").concat(e.countryCode):"-"},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(p.e,{user:t.user,isEnabled:!t.user.disabledAt})}];return(0,s.jsx)(d.Z,{className:"table-container",pagination:{hideOnSinglePage:!0},columns:n,dataSource:t,size:"small",rowKey:"id"})};var y=n(71577),x=n(58091),b=n(84674);const j=e=>{let{data:t}=e;const n=[{title:"IP Address",dataIndex:"ipAddress",key:"ipAddress"},{title:"Reason",dataIndex:"notes",key:"notes"},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>function(e){return(0,x.Z)(new Date(e),"MMM d H:mma")}(e),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,s.jsx)(y.Z,{title:"Remove IP Address Ban",onClick:()=>async function(e){try{await(0,c.rQ)(c.RB,{data:{value:e},method:"POST",auth:!0})}catch(t){console.error(t)}}(t.ipAddress),icon:(0,s.jsx)(b.Z,{twoToneColor:"#ff4d4f"}),className:"block-user-button"})}];return(0,s.jsx)(d.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:n,dataSource:t,size:"large",rowKey:"ipAddress"})},v=1e4;function w(){const e=(0,r.useContext)(o.aC),{online:t}=e||{},[n,l]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),[m,h]=(0,r.useState)([]),[p,g]=(0,r.useState)([]),y=async()=>{try{const e=await(0,c.rQ)(c.qk);l(e)}catch(e){console.log("==== error",e)}try{const e=await(0,c.rQ)(c.Kp);h(e)}catch(t){console.log("==== error",t)}try{const e=await(0,c.rQ)(c.GC);g(e)}catch(n){console.error("error fetching moderators",n)}try{const e=await(0,c.rQ)(c.Bu);u(e)}catch(s){console.error("error fetching banned ips",s)}};(0,r.useEffect)((()=>{let e=null;return y(),e=setInterval(y,v),()=>{clearInterval(e)}}),[t]);const x=t?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f,{data:m}),(0,s.jsxs)("p",{className:"description",children:["Visit the"," ",(0,s.jsx)("a",{href:"https://owncast.online/docs/viewers/?source=admin",target:"_blank",rel:"noopener noreferrer",children:"documentation"})," ","to configure additional details about your viewers."]})]}):(0,s.jsx)("p",{className:"description",children:"When a stream is active and chat is enabled, connected chat clients will be displayed here."}),b=[{label:(0,s.jsxs)("span",{children:["Connected ",t?"(".concat(m.length,")"):"(offline)"]}),key:"1",children:x},{label:(0,s.jsxs)("span",{children:["Banned Users (",n.length,")"]}),key:"2",children:(0,s.jsx)(i.K,{data:n})},{label:(0,s.jsxs)("span",{children:["IP Bans (",d.length,")"]}),key:"3",children:(0,s.jsx)(j,{data:d})},{label:(0,s.jsxs)("span",{children:["Moderators (",p.length,")"]}),key:"4",children:(0,s.jsx)(i.K,{data:p})}];return(0,s.jsx)(a.Z,{defaultActiveKey:"1",items:b})}},70241:function(e,t,n){"use strict";n.d(t,{AB:function(){return l},Qr:function(){return o},t5:function(){return a},wS:function(){return i}});var s=n(42238),r=n.n(s);function a(e){const t=e.split(":");t[t.length-1]="";let n=t.join(":");return n=n.slice(0,n.length-1),"[::1]"===n||"127.0.0.1"===n?"Localhost":n}function o(e){return!e||0===Object.keys(e).length&&e.constructor===Object}function c(e,t,n){return String(t.repeat(n)+e).slice(-n)}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=Number.isFinite(+e)?Math.abs(e):0,n=Math.floor(t/86400),s=n>0?"".concat(n," day").concat(n>1?"s":""," "):"",r=Math.floor(t/3600%24),a=r||n?c("".concat(r,":"),"0",3):"",o=Math.floor(t/60%60),i=c("".concat(o,":"),"0",3),l=Math.floor(t%60),d=c("".concat(l),"0",2);return s+a+i+d}function l(e){const t=r()(e),{device:n,os:s,browser:a}=t,{major:o,name:c}=a,{version:i,name:l}=s,{model:d,type:u}=n;if("libmpv"===e)return"mpv media player";if(!c||!o||!l)return e;const m=d||u?" (".concat(d||u,")"):"";return"".concat(c," ").concat(o," on ").concat(l," ").concat(i,"\n  ").concat(m)}},99519:function(e,t,n){"use strict";n.d(t,{aC:function(){return d}});var s=n(85893),r=n(67294),a=n(45697),o=n.n(a),c=n(64777);const i={streamKeys:[],adminPassword:"",instanceDetails:{customStyles:"",extraPageContent:"",logo:"",name:"",nsfw:!1,socialHandles:[],streamTitle:"",summary:"",tags:[],title:"",welcomeMessage:"",offlineMessage:"",appearanceVariables:{}},ffmpegPath:"",rtmpServerPort:"",webServerPort:"",socketHostOverride:null,s3:{accessKey:"",acl:"",bucket:"",enabled:!1,endpoint:"",region:"",secret:"",servingEndpoint:"",forcePathStyle:!1},yp:{enabled:!1,instanceUrl:""},videoSettings:{latencyLevel:4,cpuUsageLevel:3,videoQualityVariants:[n(90745).gX]},federation:{enabled:!1,isPrivate:!1,username:"",goLiveMessage:"",showEngagement:!0,blockedDomains:[]},notifications:{browser:{enabled:!1,goLiveMessage:""},discord:{enabled:!1,webhook:"",goLiveMessage:""},twitter:{enabled:!1,goLiveMessage:"",apiKey:"",apiSecret:"",accessToken:"",accessTokenSecret:"",bearerToken:""}},externalActions:[],supportedCodecs:[],videoCodec:"",forbiddenUsernames:[],suggestedUsernames:[],chatDisabled:!1,chatJoinMessagesEnabled:!0,chatEstablishedUserMode:!1,hideViewerCount:!1},l={broadcastActive:!1,broadcaster:null,currentBroadcast:null,online:!1,viewerCount:0,sessionMaxViewerCount:0,sessionPeakViewerCount:0,overallPeakViewerCount:0,versionNumber:"0.0.0",streamTitle:"",chatDisabled:!1,health:{healthy:!0,healthPercentage:100,message:"",representation:0}},d=r.createContext({...l,serverConfig:i,setFieldInConfigState:e=>null}),u=e=>{let{children:t}=e;const[n,a]=(0,r.useState)(l),[o,u]=(0,r.useState)(i),m=async()=>{try{const e=await(0,c.rQ)(c.Q_);a({...e})}catch(e){}};(0,r.useEffect)((()=>{let e=null;return m(),e=setInterval(m,c.NE),(async()=>{try{const e=await(0,c.rQ)(c.bl);u(e)}catch(e){}})(),()=>{clearInterval(e)}}),[]);const h={...n,serverConfig:o,setFieldInConfigState:e=>{let{fieldName:t,value:n,path:s}=e;const r=s?{...o,[s]:{...o[s],[t]:n}}:{...o,[t]:n};u(r)}};return(0,s.jsx)(d.Provider,{value:h,children:t})};u.propTypes={children:o().element.isRequired},t.ZP=u},92703:function(e,t,n){"use strict";var s=n(50414);function r(){}function a(){}a.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,a,o){if(o!==s){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},45697:function(e,t,n){e.exports=n(92703)()},50414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},function(e){e.O(0,[3662,5596,481,173,1407,4083,6880,3174,1577,6386,3013,3698,2459,8213,9915,715,5402,1908,575,1834,8067,5938,2024,745,9774,2888,179],(function(){return t=55583,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
//# sourceMappingURL=users-6efaf55769eeb64b.js.map