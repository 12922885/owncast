(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9522],{55583:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/chat/users",function(){return n(40528)}])},94538:function(e,t,n){"use strict";n.d(t,{e:function(){return d}});var r=n(85893),s=n(85402),a=n(71577),o=n(21640),l=n(82911),i=n(84674),c=n(64777);let d=e=>{let{user:t,isEnabled:n,label:d,onClick:u}=e;async function h(e){let{id:t}=e;try{let r=await (0,c.rQ)(c.NM,{data:{userId:t,enabled:!n},method:"POST",auth:!0});return r.success}catch(s){console.error(s)}return!1}let m=n?"ban":"unban",p=n?(0,r.jsx)(o.Z,{style:{color:"var(--ant-error)"}}):(0,r.jsx)(l.Z,{style:{color:"var(--ant-warning)"}}),g=(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to ",m," ",(0,r.jsx)("strong",{children:t.displayName}),n?" and remove their messages?":"?"]}),f=()=>{s.Z.confirm({title:"Confirm ".concat(m),content:g,onCancel:()=>{},onOk:()=>new Promise((e,n)=>{let r=h(t);r?setTimeout(()=>{e(r),null==u||u()},3e3):n()}),okType:"danger",okText:n?"Absolutely":null,icon:p})};return(0,r.jsx)(a.Z,{type:"primary",onClick:f,size:"small",icon:n?(0,r.jsx)(i.Z,{twoToneColor:"#ff4d4f"}):null,className:"block-user-button",children:d||m})};d.defaultProps={label:"",onClick:null}},6491:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var r=n(85893),s=n(67294),a=n(94199),o=n(85402),l=n(6880),i=n(71230),c=n(15746),d=n(27049),u=n(26713),h=n(45938),m=n(58091),p=n(96486),g=n(94538),f=n(71577),y=n(21640),x=n(82911),b=n(84674),j=n(24478),v=n(64777);let w=e=>{var t;let{user:n,onClick:s}=e;async function a(e,t){let{id:n}=e;try{let r=await (0,v.rQ)(v.jr,{data:{userId:n,isModerator:t},method:"POST",auth:!0});return r.success}catch(s){console.error(s)}return!1}let l=null===(t=n.scopes)||void 0===t?void 0:t.includes("MODERATOR"),i=l?"remove moderator":"add moderator",c=l?(0,r.jsx)(y.Z,{style:{color:"var(--ant-error)"}}):(0,r.jsx)(x.Z,{style:{color:"var(--ant-warning)"}}),d=(0,r.jsxs)(r.Fragment,{children:["Are you sure you want to ",i," ",(0,r.jsx)("strong",{children:n.displayName}),"?"]}),u=()=>{o.Z.confirm({title:"Confirm ".concat(i),content:d,onCancel:()=>{},onOk:()=>new Promise((e,t)=>{let r=a(n,!l);r?setTimeout(()=>{e(r),null==s||s()},3e3):t()}),okType:"danger",okText:l?"Yup!":null,icon:c})};return(0,r.jsx)(f.Z,{type:"primary",onClick:u,size:"small",icon:l?(0,r.jsx)(b.Z,{twoToneColor:"#ff4d4f"}):(0,r.jsx)(j.Z,{twoToneColor:"#22bb44"}),className:"block-user-button",children:i})};w.defaultProps={onClick:null};var k=n(45840),C=n(70241);let T=e=>{let{user:t,connectionInfo:n,children:f}=e,[y,x]=(0,s.useState)(!1),b=()=>{x(!0)},j=()=>{x(!1)},{displayName:v,createdAt:T,previousNames:N,nameChangedAt:A,disabledAt:Z}=t,{connectedAt:P,messageCount:D,userAgent:S}=n||{},I=null,O=N&&[...N];N&&N.length>1&&A&&(I=new Date(A),O.reverse());let M=new Date(T),E=(0,m.Z)(M,"PP pp"),_=I?(0,h.Z)(I):null;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{title:(0,r.jsxs)(r.Fragment,{children:["Created at: ",E,".",(0,r.jsx)("br",{})," Click for more info."]}),placement:"bottomLeft",children:(0,r.jsx)("button",{type:"button","aria-label":"Display more details about this user",className:"user-item-container",onClick:b,children:f})}),(0,r.jsx)(o.Z,{destroyOnClose:!0,width:600,cancelText:"Close",okButtonProps:{style:{display:"none"}},title:"User details: ".concat(v),open:y,onOk:j,onCancel:j,children:(0,r.jsxs)("div",{className:"user-details",children:[(0,r.jsx)(l.Z.Title,{level:4,children:v}),(0,r.jsxs)("p",{className:"created-at",children:["User created at ",E,"."]}),(0,r.jsxs)(i.Z,{gutter:16,children:[n&&(0,r.jsxs)(c.Z,{md:I?12:24,children:[(0,r.jsx)(l.Z.Title,{level:5,children:"This user is currently connected to Chat."}),(0,r.jsxs)("ul",{className:"connection-info",children:[(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Active for:"})," ",(0,h.Z)(new Date(P))]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"Messages sent:"})," ",D]}),(0,r.jsxs)("li",{children:[(0,r.jsx)("strong",{children:"User Agent:"}),(0,r.jsx)("br",{}),(0,C.AB)(S)]})]})]}),I&&(0,r.jsxs)(c.Z,{md:n?12:24,children:[(0,r.jsx)(l.Z.Title,{level:5,children:"This user is also seen as:"}),(0,r.jsx)("ul",{className:"previous-names-list",children:(0,p.uniq)(O).map((e,t)=>(0,r.jsxs)("li",{className:0===t?"latest":"",children:[(0,r.jsx)("span",{className:"user-name-item",children:e}),0===t?" (Changed ".concat(_," ago)"):""]}))})]})]}),(0,r.jsx)(d.Z,{}),(0,r.jsxs)(u.Z,{direction:"horizontal",children:[Z?(0,r.jsxs)(r.Fragment,{children:["This user was banned on ",(0,r.jsx)("code",{children:(0,k.u)(Z)}),".",(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)(g.e,{label:"Unban this user",user:t,isEnabled:!1,onClick:j})]}):(0,r.jsx)(g.e,{label:"Ban this user",user:t,isEnabled:!0,onClick:j}),(0,r.jsx)(w,{user:t,onClick:j})]})]})})]})};T.defaultProps={connectionInfo:null}},45840:function(e,t,n){"use strict";n.d(t,{K:function(){return c},u:function(){return i}});var r=n(85893),s=n(48213),a=n(58091),o=n(6491),l=n(94538);function i(e){return(0,a.Z)(new Date(e),"MMM d H:mma")}let c=e=>{let{data:t}=e;return(0,r.jsx)(s.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"Last Known Display Name",dataIndex:"displayName",key:"displayName",render:(e,t)=>(0,r.jsx)(o.Z,{user:t,children:(0,r.jsx)("span",{className:"display-name",children:e})})},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>i(e),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"Disabled at",dataIndex:"disabledAt",key:"disabledAt",defaultSortOrder:"descend",render:e=>e?i(e):null,sorter:(e,t)=>new Date(e.disabledAt).getTime()-new Date(t.disabledAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,r.jsx)(l.e,{user:t,isEnabled:!t.disabledAt})}],dataSource:t,size:"small",rowKey:"id"})}},40528:function(e,t,n){"use strict";n.r(t),n.d(t,{FETCH_INTERVAL:function(){return w},default:function(){return k}});var r=n(85893),s=n(67294),a=n(90575),o=n(99519),l=n(64777),i=n(45840),c=n(69677),d=n(48213),u=n(68795),h=n(45938),m=n(6491),p=n(94538),g=n(70241);let f=e=>{let{data:t}=e,n=[{title:"Display Name",key:"username",render:e=>{let{user:t,connectedAt:n,messageCount:s,userAgent:a}=e;return(0,r.jsx)(m.Z,{user:t,connectionInfo:{connectedAt:n,messageCount:s,userAgent:a},children:(0,r.jsx)("span",{className:"display-name",children:t.displayName})})},sorter:(e,t)=>t.user.displayName.localeCompare(e.user.displayName),filterIcon:(0,r.jsx)(u.Z,{}),filterDropdown:e=>{let{setSelectedKeys:t,selectedKeys:n,confirm:s}=e;return(0,r.jsx)("div",{style:{padding:8},children:(0,r.jsx)(c.Z,{placeholder:"Search display names...",value:n[0],onChange:e=>{t(e.target.value?[e.target.value]:[]),s({closeDropdown:!1})}})})},onFilter:(e,t)=>t.user.displayName.includes(e),sortDirections:["descend","ascend"]},{title:"Messages sent",dataIndex:"messageCount",key:"messageCount",className:"number-col",width:"12%",sorter:(e,t)=>e.messageCount-t.messageCount,sortDirections:["descend","ascend"],render:e=>(0,r.jsx)("div",{style:{textAlign:"center"},children:e})},{title:"Connected Time",dataIndex:"connectedAt",key:"connectedAt",defaultSortOrder:"ascend",render:e=>(0,h.Z)(new Date(e)),sorter:(e,t)=>new Date(t.connectedAt).getTime()-new Date(e.connectedAt).getTime(),sortDirections:["descend","ascend"]},{title:"User Agent",dataIndex:"userAgent",key:"userAgent",render:e=>(0,g.AB)(e)},{title:"Location",dataIndex:"geo",key:"geo",render:e=>e?"".concat(e.regionName,", ").concat(e.countryCode):"-"},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,r.jsx)(p.e,{user:t.user,isEnabled:!t.user.disabledAt})}];return(0,r.jsx)(d.Z,{className:"table-container",pagination:{hideOnSinglePage:!0},columns:n,dataSource:t,size:"small",rowKey:"id"})};var y=n(71577),x=n(58091),b=n(84674);async function j(e){try{await (0,l.rQ)(l.RB,{data:{value:e},method:"POST",auth:!0})}catch(t){console.error(t)}}let v=e=>{let{data:t}=e;return(0,r.jsx)(d.Z,{pagination:{hideOnSinglePage:!0},className:"table-container",columns:[{title:"IP Address",dataIndex:"ipAddress",key:"ipAddress"},{title:"Reason",dataIndex:"notes",key:"notes"},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>(0,x.Z)(new Date(e),"MMM d H:mma"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["descend","ascend"]},{title:"",key:"block",className:"actions-col",render:(e,t)=>(0,r.jsx)(y.Z,{title:"Remove IP Address Ban",onClick:()=>j(t.ipAddress),icon:(0,r.jsx)(b.Z,{twoToneColor:"#ff4d4f"}),className:"block-user-button"})}],dataSource:t,size:"large",rowKey:"ipAddress"})},w=1e4;function k(){let e=(0,s.useContext)(o.aC),{online:t}=e||{},[n,c]=(0,s.useState)([]),[d,u]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[p,g]=(0,s.useState)([]),y=async()=>{try{let e=await (0,l.rQ)(l.qk);c(e)}catch(t){console.log("==== error",t)}try{let n=await (0,l.rQ)(l.Kp);m(n)}catch(r){console.log("==== error",r)}try{let s=await (0,l.rQ)(l.GC);g(s)}catch(a){console.error("error fetching moderators",a)}try{let o=await (0,l.rQ)(l.Bu);u(o)}catch(i){console.error("error fetching banned ips",i)}};(0,s.useEffect)(()=>{let e=null;return y(),e=setInterval(y,w),()=>{clearInterval(e)}},[t]);let x=t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(f,{data:h}),(0,r.jsxs)("p",{className:"description",children:["Visit the"," ",(0,r.jsx)("a",{href:"https://owncast.online/docs/viewers/?source=admin",target:"_blank",rel:"noopener noreferrer",children:"documentation"})," ","to configure additional details about your viewers."]})]}):(0,r.jsx)("p",{className:"description",children:"When a stream is active and chat is enabled, connected chat clients will be displayed here."}),b=(0,r.jsxs)("span",{children:["Connected ",t?"(".concat(h.length,")"):"(offline)"]}),j=(0,r.jsxs)("span",{children:["Banned Users (",n.length,")"]}),k=(0,r.jsx)(i.K,{data:n}),C=(0,r.jsxs)("span",{children:["IP Bans (",d.length,")"]}),T=(0,r.jsx)(v,{data:d}),N=(0,r.jsxs)("span",{children:["Moderators (",p.length,")"]}),A=(0,r.jsx)(i.K,{data:p});return(0,r.jsx)(a.Z,{defaultActiveKey:"1",items:[{label:b,key:"1",children:x},{label:j,key:"2",children:k},{label:C,key:"3",children:T},{label:N,key:"4",children:A}]})}},70241:function(e,t,n){"use strict";n.d(t,{AB:function(){return c},Qr:function(){return o},t5:function(){return a},wS:function(){return i}});var r=n(42238),s=n.n(r);function a(e){let t=e.split(":");t[t.length-1]="";let n=t.join(":");return"[::1]"===(n=n.slice(0,n.length-1))||"127.0.0.1"===n?"Localhost":n}function o(e){return!e||0===Object.keys(e).length&&e.constructor===Object}function l(e,t,n){return String(t.repeat(n)+e).slice(-n)}function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=Number.isFinite(+e)?Math.abs(e):0,n=Math.floor(t/86400),r=n>0?"".concat(n," day").concat(n>1?"s":""," "):"",s=Math.floor(t/3600%24),a=s||n?l("".concat(s,":"),"0",3):"",o=l("".concat(Math.floor(t/60%60),":"),"0",3),i=l("".concat(Math.floor(t%60)),"0",2);return r+a+o+i}function c(e){let t=s()(e),{device:n,os:r,browser:a}=t,{major:o,name:l}=a,{version:i,name:c}=r,{model:d,type:u}=n;return"libmpv"===e?"mpv media player":l&&o&&c?"".concat(l," ").concat(o," on ").concat(c," ").concat(i,"\n  ").concat(d||u?" (".concat(d||u,")"):""):e}},99519:function(e,t,n){"use strict";n.d(t,{aC:function(){return u}});var r=n(85893),s=n(67294),a=n(45697),o=n.n(a),l=n(64777),i=n(90745);let c={streamKeys:[],adminPassword:"",instanceDetails:{customStyles:"",extraPageContent:"",logo:"",name:"",nsfw:!1,socialHandles:[],streamTitle:"",summary:"",tags:[],title:"",welcomeMessage:"",offlineMessage:"",appearanceVariables:{}},ffmpegPath:"",rtmpServerPort:"",webServerPort:"",socketHostOverride:null,s3:{accessKey:"",acl:"",bucket:"",enabled:!1,endpoint:"",region:"",secret:"",servingEndpoint:"",forcePathStyle:!1},yp:{enabled:!1,instanceUrl:""},videoSettings:{latencyLevel:4,cpuUsageLevel:3,videoQualityVariants:[i.gX]},federation:{enabled:!1,isPrivate:!1,username:"",goLiveMessage:"",showEngagement:!0,blockedDomains:[]},notifications:{browser:{enabled:!1,goLiveMessage:""},discord:{enabled:!1,webhook:"",goLiveMessage:""},twitter:{enabled:!1,goLiveMessage:"",apiKey:"",apiSecret:"",accessToken:"",accessTokenSecret:"",bearerToken:""}},externalActions:[],supportedCodecs:[],videoCodec:"",forbiddenUsernames:[],suggestedUsernames:[],chatDisabled:!1,chatJoinMessagesEnabled:!0,chatEstablishedUserMode:!1,hideViewerCount:!1},d={broadcastActive:!1,broadcaster:null,currentBroadcast:null,online:!1,viewerCount:0,sessionMaxViewerCount:0,sessionPeakViewerCount:0,overallPeakViewerCount:0,versionNumber:"0.0.0",streamTitle:"",chatDisabled:!1,health:{healthy:!0,healthPercentage:100,message:"",representation:0}},u=s.createContext({...d,serverConfig:c,setFieldInConfigState:e=>null}),h=e=>{let{children:t}=e,[n,a]=(0,s.useState)(d),[o,i]=(0,s.useState)(c),h=async()=>{try{let e=await (0,l.rQ)(l.Q_);a({...e})}catch(t){}},m=async()=>{try{let e=await (0,l.rQ)(l.bl);i(e)}catch(t){}},p=e=>{let{fieldName:t,value:n,path:r}=e,s=r?{...o,[r]:{...o[r],[t]:n}}:{...o,[t]:n};i(s)};(0,s.useEffect)(()=>{let e=null;return h(),e=setInterval(h,l.NE),m(),()=>{clearInterval(e)}},[]);let g={...n,serverConfig:o,setFieldInConfigState:p};return(0,r.jsx)(u.Provider,{value:g,children:t})};h.propTypes={children:o().element.isRequired},t.ZP=h},92703:function(e,t,n){"use strict";var r=n(50414);function s(){}function a(){}a.resetWarningCache=s,e.exports=function(){function e(e,t,n,s,a,o){if(o!==r){var l=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw l.name="Invariant Violation",l}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:s};return n.PropTypes=n,n}},45697:function(e,t,n){e.exports=n(92703)()},50414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},function(e){e.O(0,[3662,5596,481,173,1407,4083,1577,6880,3174,2459,6386,3013,3698,8213,9915,6754,195,5402,1834,575,8067,5938,450,745,9774,2888,179],function(){return e(e.s=55583)}),_N_E=e.O()}]);
//# sourceMappingURL=users-03ad9f6bc51a6cb3.js.map