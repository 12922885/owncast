{"version":3,"file":"static/chunks/pages/admin/chat/emojis-2a5cdd9e4ca6dff2.js","mappings":"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","sources":["webpack://_N_E/?59b5","webpack://_N_E/./utils/constants.js","webpack://_N_E/./pages/admin/chat/emojis.tsx","webpack://_N_E/./utils/images.ts","webpack://_N_E/./utils/input-statuses.tsx"],"sourcesContent":["\n    (window.__NEXT_P = window.__NEXT_P || []).push([\n      \"/admin/chat/emojis\",\n      function () {\n        return require(\"private-next-pages/admin/chat/emojis.tsx\");\n      }\n    ]);\n    if(module.hot) {\n      module.hot.dispose(function () {\n        window.__NEXT_P.push([\"/admin/chat/emojis\"])\n      });\n    }\n  ","// misc constants used throughout the app\n\nexport const URL_STATUS = `/api/status`;\nexport const URL_CHAT_HISTORY = `/api/chat`;\nexport const URL_CUSTOM_EMOJIS = `/api/emoji`;\nexport const URL_CONFIG = `/api/config`;\nexport const URL_VIEWER_PING = `/api/ping`;\n\n// inline moderation actions\nexport const URL_HIDE_MESSAGE = `/api/chat/messagevisibility`;\nexport const URL_BAN_USER = `/api/chat/users/setenabled`;\n\n// TODO: This directory is customizable in the config.  So we should expose this via the config API.\nexport const URL_STREAM = `/hls/stream.m3u8`;\n// export const URL_WEBSOCKET = `${location.protocol === 'https:' ? 'wss' : 'ws'}://${\n//   location.host\n// }/ws`;\nexport const URL_CHAT_REGISTRATION = `/api/chat/register`;\nexport const URL_FOLLOWERS = `/api/followers`;\nexport const URL_PLAYBACK_METRICS = `/api/metrics/playback`;\n\nexport const URL_REGISTER_NOTIFICATION = `/api/notifications/register`;\nexport const URL_REGISTER_EMAIL_NOTIFICATION = `/api/notifications/register/email`;\nexport const URL_CHAT_INDIEAUTH_BEGIN = `/api/auth/indieauth`;\n\nexport const TIMER_STATUS_UPDATE = 5000; // ms\nexport const TIMER_DISABLE_CHAT_AFTER_OFFLINE = 5 * 60 * 1000; // 5 mins\nexport const TIMER_STREAM_DURATION_COUNTER = 1000;\nexport const TEMP_IMAGE =\n  'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\nexport const OWNCAST_LOGO_LOCAL = '/img/logo.svg';\n\nexport const MESSAGE_OFFLINE = 'Stream is offline.';\nexport const MESSAGE_ONLINE = 'Stream is online.';\n\nexport const URL_OWNCAST = 'https://owncast.online'; // used in footer\nexport const PLAYER_VOLUME = 'owncast_volume';\n\nexport const KEY_ACCESS_TOKEN = 'owncast_access_token';\nexport const KEY_EMBED_CHAT_ACCESS_TOKEN = 'owncast_embed_chat_access_token';\nexport const KEY_USERNAME = 'owncast_username';\nexport const KEY_CUSTOM_USERNAME_SET = 'owncast_custom_username_set';\nexport const KEY_CHAT_DISPLAYED = 'owncast_chat';\nexport const KEY_CHAT_FIRST_MESSAGE_SENT = 'owncast_first_message_sent';\nexport const CHAT_INITIAL_PLACEHOLDER_TEXT = 'Type here to chat, no account necessary.';\nexport const CHAT_PLACEHOLDER_TEXT = 'Message';\nexport const CHAT_PLACEHOLDER_OFFLINE = 'Chat is offline.';\nexport const CHAT_MAX_MESSAGE_LENGTH = 500;\nexport const EST_SOCKET_PAYLOAD_BUFFER = 512;\nexport const CHAT_CHAR_COUNT_BUFFER = 20;\nexport const CHAT_OK_KEYCODES = [\n  'ArrowLeft',\n  'ArrowUp',\n  'ArrowRight',\n  'ArrowDown',\n  'Shift',\n  'Meta',\n  'Alt',\n  'Delete',\n  'Backspace',\n];\nexport const CHAT_KEY_MODIFIERS = ['Control', 'Shift', 'Meta', 'Alt'];\nexport const MESSAGE_JUMPTOBOTTOM_BUFFER = 500;\n\n// app styling\nexport const WIDTH_SINGLE_COL = 780;\nexport const HEIGHT_SHORT_WIDE = 500;\nexport const ORIENTATION_PORTRAIT = 'portrait';\nexport const ORIENTATION_LANDSCAPE = 'landscape';\n\n// localstorage keys\nexport const HAS_DISPLAYED_NOTIFICATION_MODAL_KEY = 'HAS_DISPLAYED_NOTIFICATION_MODAL';\nexport const USER_VISIT_COUNT_KEY = 'USER_VISIT_COUNT';\nexport const USER_DISMISSED_ANNOYING_NOTIFICATION_POPUP_KEY =\n  'USER_DISMISSED_ANNOYING_NOTIFICATION_POPUP_KEY';\n","import { DeleteOutlined } from '@ant-design/icons';\nimport { Button, Space, Table, Typography, Upload } from 'antd';\nimport { RcFile } from 'antd/lib/upload';\nimport React, { useEffect, useState } from 'react';\nimport FormStatusIndicator from '../../../components/admin/FormStatusIndicator';\n\nimport { DELETE_EMOJI, fetchData, UPLOAD_EMOJI } from '../../../utils/apis';\n\nimport { ACCEPTED_IMAGE_TYPES, getBase64 } from '../../../utils/images';\nimport {\n  createInputStatus,\n  STATUS_ERROR,\n  STATUS_PROCESSING,\n  STATUS_SUCCESS,\n} from '../../../utils/input-statuses';\nimport { RESET_TIMEOUT } from '../../../utils/config-constants';\nimport { URL_CUSTOM_EMOJIS } from '../../../utils/constants';\n\ntype CustomEmoji = {\n  name: string;\n  url: string;\n};\n\nconst { Title, Paragraph } = Typography;\n\nconst Emoji = () => {\n  const [emojis, setEmojis] = useState<CustomEmoji[]>([]);\n\n  const [loading, setLoading] = useState(false);\n  const [submitStatus, setSubmitStatus] = useState(null);\n  const [uploadFile, setUploadFile] = useState<RcFile>(null);\n\n  let resetTimer = null;\n  const resetStates = () => {\n    setSubmitStatus(null);\n    clearTimeout(resetTimer);\n    resetTimer = null;\n  };\n\n  async function getEmojis() {\n    setLoading(true);\n    try {\n      const response = await fetchData(URL_CUSTOM_EMOJIS);\n      setEmojis(response);\n    } catch (error) {\n      console.error('error fetching emojis', error);\n    }\n    setLoading(false);\n  }\n  useEffect(() => {\n    getEmojis();\n  }, []);\n\n  async function handleDelete(fullPath: string) {\n    const name = `/${fullPath.split('/').slice(3).join('/')}`;\n    console.log(name);\n\n    setLoading(true);\n\n    setSubmitStatus(createInputStatus(STATUS_PROCESSING, 'Deleting emoji...'));\n\n    try {\n      const response = await fetchData(DELETE_EMOJI, {\n        method: 'POST',\n        data: { name },\n      });\n\n      if (response instanceof Error) {\n        throw response;\n      }\n\n      setSubmitStatus(createInputStatus(STATUS_SUCCESS, 'Emoji deleted'));\n      resetTimer = setTimeout(resetStates, RESET_TIMEOUT);\n    } catch (error) {\n      setSubmitStatus(createInputStatus(STATUS_ERROR, `${error}`));\n      setLoading(false);\n      resetTimer = setTimeout(resetStates, RESET_TIMEOUT);\n    }\n\n    getEmojis();\n  }\n\n  async function handleEmojiUpload() {\n    setLoading(true);\n    try {\n      setSubmitStatus(createInputStatus(STATUS_PROCESSING, 'Converting emoji...'));\n\n      // eslint-disable-next-line consistent-return\n      const emojiData = await new Promise<CustomEmoji>((res, rej) => {\n        if (!ACCEPTED_IMAGE_TYPES.includes(uploadFile.type)) {\n          const msg = `File type is not supported: ${uploadFile.type}`;\n          // eslint-disable-next-line no-promise-executor-return\n          return rej(msg);\n        }\n\n        getBase64(uploadFile, (url: string) =>\n          res({\n            name: uploadFile.name,\n            url,\n          }),\n        );\n      });\n\n      setSubmitStatus(createInputStatus(STATUS_PROCESSING, 'Uploading emoji...'));\n\n      const response = await fetchData(UPLOAD_EMOJI, {\n        method: 'POST',\n        data: {\n          name: emojiData.name,\n          data: emojiData.url,\n        },\n      });\n\n      if (response instanceof Error) {\n        throw response;\n      }\n\n      setSubmitStatus(createInputStatus(STATUS_SUCCESS, 'Emoji uploaded successfully!'));\n      getEmojis();\n    } catch (error) {\n      setSubmitStatus(createInputStatus(STATUS_ERROR, `${error}`));\n    }\n\n    resetTimer = setTimeout(resetStates, RESET_TIMEOUT);\n    setLoading(false);\n  }\n\n  const columns = [\n    {\n      title: '',\n      key: 'delete',\n      render: (text, record) => (\n        <Space size=\"middle\">\n          <Button onClick={() => handleDelete(record.url)} icon={<DeleteOutlined />} />\n        </Space>\n      ),\n    },\n    {\n      title: 'Name',\n      key: 'name',\n      dataIndex: 'name',\n    },\n    {\n      title: 'Emoji',\n      key: 'url',\n      render: (text, record) => (\n        <img src={record.url} alt={record.name} style={{ maxWidth: '2vw' }} />\n      ),\n    },\n  ];\n\n  return (\n    <div>\n      <Title>Emojis</Title>\n      <Paragraph>\n        Here you can upload new custom emojis for usage in the chat. When uploading a new emoji, the\n        filename will be used as emoji name.\n      </Paragraph>\n\n      <Table\n        rowKey={record => record.url}\n        dataSource={emojis}\n        columns={columns}\n        pagination={false}\n      />\n      <br />\n      <Upload\n        name=\"emoji\"\n        listType=\"picture\"\n        className=\"emoji-uploader\"\n        showUploadList={false}\n        accept={ACCEPTED_IMAGE_TYPES.join(',')}\n        beforeUpload={setUploadFile}\n        customRequest={handleEmojiUpload}\n        disabled={loading}\n      >\n        <Button type=\"primary\" disabled={loading}>\n          Upload new emoji\n        </Button>\n      </Upload>\n      <FormStatusIndicator status={submitStatus} />\n    </div>\n  );\n};\n\nexport default Emoji;\n","export const MAX_IMAGE_FILESIZE = 2097152;\nexport const ACCEPTED_IMAGE_TYPES = ['image/png', 'image/jpeg', 'image/gif'];\n\nexport function getBase64(img: File | Blob, callback: (imageUrl: string | ArrayBuffer) => void) {\n  const reader = new FileReader();\n  reader.addEventListener('load', () => callback(reader.result));\n  reader.readAsDataURL(img);\n}\n\nexport function readableBytes(bytes: number): string {\n  const index = Math.floor(Math.log(bytes) / Math.log(1024));\n  const SIZE_UNITS = ['B', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];\n  const size = Number((bytes / Math.pow(1024, index)).toFixed(2)) * 1;\n\n  return `${size} ${SIZE_UNITS[index]}`;\n}\n","import {\n  CheckCircleFilled,\n  ExclamationCircleFilled,\n  LoadingOutlined,\n  WarningOutlined,\n} from '@ant-design/icons';\n\nexport const STATUS_RESET_TIMEOUT = 3000;\n\nexport const STATUS_ERROR = 'error';\nexport const STATUS_INVALID = 'invalid';\nexport const STATUS_PROCESSING = 'proessing';\nexport const STATUS_SUCCESS = 'success';\nexport const STATUS_WARNING = 'warning';\n\nexport type InputStatusTypes = 'error' | 'invalid' | 'proessing' | 'success' | 'warning';\n\nexport interface StatusState {\n  type: InputStatusTypes;\n  icon: any; // Element type of sorts?\n  message: string;\n}\ninterface InputStates {\n  [key: string]: StatusState;\n}\n\nexport const INPUT_STATES: InputStates = {\n  [STATUS_SUCCESS]: {\n    type: STATUS_SUCCESS,\n    icon: <CheckCircleFilled style={{ color: 'green' }} />,\n    message: 'Success!',\n  },\n  [STATUS_ERROR]: {\n    type: STATUS_ERROR,\n    icon: <ExclamationCircleFilled style={{ color: 'red' }} />,\n    message: 'An error occurred.',\n  },\n  [STATUS_INVALID]: {\n    type: STATUS_INVALID,\n    icon: <ExclamationCircleFilled style={{ color: 'red' }} />,\n    message: 'An error occurred.',\n  },\n  [STATUS_PROCESSING]: {\n    type: STATUS_PROCESSING,\n    icon: <LoadingOutlined />,\n    message: '',\n  },\n  [STATUS_WARNING]: {\n    type: STATUS_WARNING,\n    icon: <WarningOutlined style={{ color: '#fc0' }} />,\n    message: '',\n  },\n};\n\n// Don't like any of the default messages in INPUT_STATES? Create a state with custom message by providing an icon style with your message.\nexport function createInputStatus(type: InputStatusTypes, message?: string): StatusState {\n  if (!type || !INPUT_STATES[type]) {\n    return null;\n  }\n  if (!message) {\n    return INPUT_STATES[type];\n  }\n  return {\n    type,\n    icon: INPUT_STATES[type].icon,\n    message,\n  };\n}\n"],"names":["window","__NEXT_P","push","Title","Paragraph","Typography","emojis","setEmojis","useState","loading","setLoading","submitStatus","setSubmitStatus","uploadFile","setUploadFile","resetTimer","resetStates","clearTimeout","async","getEmojis","response","fetchData","error","console","useEffect","columns","title","key","render","text","record","Space","size","Button","onClick","fullPath","name","split","slice","join","log","createInputStatus","STATUS_PROCESSING","DELETE_EMOJI","method","data","Error","STATUS_SUCCESS","setTimeout","RESET_TIMEOUT","STATUS_ERROR","handleDelete","url","icon","DeleteOutlined","dataIndex","img","src","alt","style","maxWidth","div","Table","rowKey","dataSource","pagination","br","Upload","listType","className","showUploadList","accept","ACCEPTED_IMAGE_TYPES","beforeUpload","customRequest","emojiData","Promise","res","rej","type","getBase64","UPLOAD_EMOJI","disabled","FormStatusIndicator","status","MAX_IMAGE_FILESIZE","callback","reader","FileReader","addEventListener","result","readAsDataURL","readableBytes","bytes","index","Math","floor","Number","pow","toFixed","SIZE_UNITS","STATUS_INVALID","STATUS_WARNING","INPUT_STATES","CheckCircleFilled","color","message","ExclamationCircleFilled","LoadingOutlined","WarningOutlined"],"sourceRoot":""}