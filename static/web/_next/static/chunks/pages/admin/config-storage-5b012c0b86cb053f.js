(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7757],{79128:function(e,n,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/config-storage",function(){return a(64417)}])},15976:function(e,n,a){"use strict";a.d(n,{Z:function(){return f}});var i=a(47568),t=a(34051),s=a.n(t),r=a(85893),c=a(67294),o=a(94594),l=a(83192),d=a(78464),u=a(25964),h=a(35159);function f(e){var n=(0,c.useState)(null),a=n[0],t=n[1],f=null,v=((0,c.useContext)(h.aC)||{}).setFieldInConfigState,p=e.apiPath,g=e.checked,m=e.reversed,x=void 0!==m&&m,j=e.configPath,Z=void 0===j?"":j,b=e.disabled,N=void 0!==b&&b,k=e.fieldName,y=e.label,C=e.tip,P=e.useSubmit,S=e.onChange,w=function(){t(null),clearTimeout(f),f=null},E=function(){var e=(0,i.Z)(s().mark((function e(n){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!P){e.next=6;break}return t((0,l.kg)(l.Jk)),a=x?!n:n,e.next=5,(0,u.Si)({apiPath:p,data:{value:a},onSuccess:function(){v({fieldName:k,value:a,path:Z}),t((0,l.kg)(l.zv))},onError:function(e){t((0,l.kg)(l.Un,"There was an error: ".concat(e)))}});case 5:f=setTimeout(w,u.sI);case 6:S&&S(n);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),_=null!==a&&a.type===l.Jk;return(0,r.jsxs)("div",{className:"formfield-container toggleswitch-container",children:[y&&(0,r.jsx)("div",{className:"label-side",children:(0,r.jsx)("span",{className:"formfield-label",children:y})}),(0,r.jsxs)("div",{className:"input-side",children:[(0,r.jsxs)("div",{className:"input-group",children:[(0,r.jsx)(o.Z,{className:"switch field-".concat(k),loading:_,onChange:E,defaultChecked:g,checked:g,checkedChildren:"ON",unCheckedChildren:"OFF",disabled:N}),(0,r.jsx)(d.Z,{status:a})]}),(0,r.jsx)("p",{className:"field-tip",children:C})]})]})}f.defaultProps={apiPath:"",checked:!1,reversed:!1,configPath:"",disabled:!1,label:"",tip:"",useSubmit:!1,onChange:null}},64417:function(e,n,a){"use strict";a.r(n),a.d(n,{default:function(){return S}});var i=a(85893),t=a(84485),s=a(67294),r=a(47568),c=a(14924),o=a(26042),l=a(69396),d=a(34051),u=a.n(d),h=a(54907),f=a(71577),v=a(94184),p=a.n(v),g=a(35159),m=a(57553),x=a(25964),j=a(83192),Z=a(13468),b=a(78464),N=a(19411),k=a(15976),y=h.Z.Panel;function C(){var e=(0,s.useState)(null),n=e[0],a=e[1],t=(0,s.useState)(null),d=t[0],v=t[1],C=(0,s.useState)(!1),P=C[0],S=C[1],w=(0,s.useContext)(g.aC)||{},E=w.serverConfig,_=w.setFieldInConfigState,z=(0,s.useContext)(m.k).setMessage,T=E.s3,O=T.accessKey,K=void 0===O?"":O,F=T.acl,I=void 0===F?"":F,U=T.bucket,D=void 0===U?"":U,J=T.enabled,X=void 0!==J&&J,L=T.endpoint,M=void 0===L?"":L,V=T.region,$=void 0===V?"":V,q=T.secret,A=void 0===q?"":q,B=T.servingEndpoint,G=void 0===B?"":B,H=T.forcePathStyle,Q=void 0!==H&&H;if((0,s.useEffect)((function(){a({accessKey:K,acl:I,bucket:D,enabled:X,endpoint:M,region:$,secret:A,servingEndpoint:G,forcePathStyle:Q}),S(X)}),[T]),!n)return null;var R=null,W=function(){v(null),R=null,clearTimeout(R)},Y=function(e){var i=e.fieldName,t=e.value;a((0,l.Z)((0,o.Z)({},n),(0,c.Z)({},i,t)))},ee=function(){var e=(0,r.Z)(u().mark((function e(){var a;return u().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v((0,j.kg)(j.Jk)),a=n,e.next=4,(0,x.Si)({apiPath:x.$w,data:{value:a},onSuccess:function(){_({fieldName:"s3",value:a,path:""}),v((0,j.kg)(j.zv,"Updated.")),R=setTimeout(W,x.sI),z("Changing your storage configuration will take place the next time you start a new stream.")},onError:function(e){v((0,j.kg)(j.Un,e)),R=setTimeout(W,x.sI)}});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=p()({"edit-storage-container":!0,"form-module":!0,enabled:P}),ae=function(e,n){var a=e.endpoint,i=e.accessKey,t=e.secret,s=e.bucket,r=e.region,c=e.enabled,o=e.servingEndpoint,l=e.acl,d=e.forcePathStyle;if(c){if(a&&(0,N.Z)(a)&&i&&t&&s&&r&&(c!==n.enabled||a!==n.endpoint||i!==n.accessKey||t!==n.secret||r!==n.region||!n.servingEndpoint&&""!==o||n.servingEndpoint&&o!==n.servingEndpoint||!n.acl&&""!==l||n.acl&&l!==n.acl||d!==n.forcePathStyle))return!0}else if(c!==n.enabled)return!0;return!1}(n,T);return(0,i.jsxs)("div",{className:ne,children:[(0,i.jsx)("div",{className:"enable-switch",children:(0,i.jsx)(k.Z,{apiPath:"",fieldName:"enabled",label:"Use S3 Storage Provider",checked:n.enabled,onChange:function(e){S(e),Y({fieldName:"enabled",value:e})}})}),(0,i.jsxs)("div",{className:"form-fields",children:[(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.endpoint),{value:n.endpoint,onChange:Y}))}),(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.accessKey),{value:n.accessKey,onChange:Y}))}),(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.secret),{value:n.secret,onChange:Y}))}),(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.bucket),{value:n.bucket,onChange:Y}))}),(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.region),{value:n.region,onChange:Y}))}),(0,i.jsx)(h.Z,{className:"advanced-section",children:(0,i.jsxs)(y,{header:"Optional Settings",children:[(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.acl),{value:n.acl,onChange:Y}))}),(0,i.jsx)("div",{className:"field-container",children:(0,i.jsx)(Z.ZP,(0,l.Z)((0,o.Z)({},x.zm.servingEndpoint),{value:n.servingEndpoint,onChange:Y}))}),(0,i.jsx)("div",{className:"enable-switch",children:(0,i.jsx)(k.Z,(0,l.Z)((0,o.Z)({},x.zm.forcePathStyle),{fieldName:"forcePathStyle",checked:n.forcePathStyle,onChange:function(e){Y({fieldName:"forcePathStyle",value:e})}}))})]},"1")})]}),(0,i.jsxs)("div",{className:"button-container",children:[(0,i.jsx)(f.Z,{type:"primary",onClick:ee,disabled:!ae,children:"Save"}),(0,i.jsx)(b.Z,{status:d})]})]})}var P=t.Z.Title;function S(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(P,{children:"Storage"}),(0,i.jsxs)("p",{className:"description",children:["Owncast supports optionally using external storage providers to stream your video. Learn more about this by visiting our"," ",(0,i.jsx)("a",{href:"https://owncast.online/docs/storage/?source=admin",target:"_blank",rel:"noopener noreferrer",children:"Storage Documentation"}),"."]}),(0,i.jsx)("p",{className:"description",children:"Configuring this incorrectly will likely cause your video to be unplayable. Double check the documentation for your storage provider on how to configure the bucket you created for Owncast."}),(0,i.jsx)("p",{className:"description",children:"Keep in mind this is for live streaming, not for archival, recording or VOD purposes."}),(0,i.jsx)(C,{})]})}}},function(e){e.O(0,[5473,9774,2888,179],(function(){return n=79128,e(e.s=n);var n}));var n=e.O();_N_E=n}]);