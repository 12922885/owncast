(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4860],{94860:function(e,n,a){"use strict";a.r(n),a.d(n,{ChatModerationActionMenu:function(){return z}});var t=a(85893),s=a(85402),o=a(12461),l=a(66516),r=a(13013),i=a(26713),c=a(67294),d=a(5152),h=a.n(d),u=a(14761),p=a(54907),x=a(71230),j=a(15746),m=a(71577),y=a(11382),b=a(20550),g=a(54398),w=a(58091),f=class{static async removeMessage(e,n){let a=new URL("/api/chat/messagevisibility",window.location.toString());a.searchParams.append("accessToken",n);let t=a.toString(),s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({idArray:[e]})};await fetch(t,s)}static async banUser(e,n){let a=new URL("/api/chat/users/setenabled",window.location.toString());a.searchParams.append("accessToken",n);let t=a.toString(),s={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})};await fetch(t,s)}},k=a(57761),v=a.n(k),C=a(70241);let{Panel:_}=p.Z,M=h()(()=>Promise.all([a.e(2074),a.e(7949)]).then(a.t.bind(a,77949,23)),{loadableGenerated:{webpack:()=>[77949]},ssr:!1}),Z=async(e,n)=>{try{f.removeMessage(e,n)}catch(a){console.error(a)}},S=e=>{let{label:n,value:a}=e;return(0,t.jsxs)(x.Z,{justify:"space-around",align:"middle",children:[(0,t.jsx)(j.Z,{span:12,children:n}),(0,t.jsx)(j.Z,{span:12,children:a})]})},P=e=>{let{client:n}=e,{messageCount:a,connectedAt:s,geo:o}=n,l=(0,w.Z)(new Date(s),"PP pp");return(0,t.jsxs)("div",{children:[(0,t.jsx)(S,{label:"Messages Sent",value:"".concat(a)}),"N/A"!==o&&(0,t.jsx)(S,{label:"Geo",value:o}),(0,t.jsx)(S,{label:"Connected At",value:l})]})},A=e=>{let{color:n}=e;return(0,t.jsxs)("div",{className:v().colorBlock,style:{backgroundColor:"var(--theme-color-users-".concat(n,")")},children:["Color ",n]})},N=e=>{let{userId:n,accessToken:a}=e,[s,o]=(0,c.useState)(null),[l,r]=(0,c.useState)(!0),i=async()=>{try{let e=await (await fetch("/api/moderation/chat/user/".concat(n,"?accessToken=").concat(a))).json();o(e),r(!1)}catch(t){console.error(t)}};if((0,c.useEffect)(()=>{i()},[]),!s)return null;let{user:d,connectedClients:h,messages:u}=s,{displayColor:x,createdAt:j,previousNames:f,scopes:k,isBot:v,authenticated:N}=d,D=h.reduce((e,n)=>e+n.messageCount,0),O=(0,w.Z)(new Date(j),"PP pp");return(0,t.jsxs)(y.Z,{spinning:l,children:[(0,t.jsx)(A,{color:x}),k.map(e=>(0,t.jsx)(b.Z,{children:e},e)),N&&(0,t.jsx)(b.Z,{children:"Authenticated"}),v&&(0,t.jsx)(b.Z,{children:"Bot"}),(0,t.jsx)(S,{label:"Messages Sent Across Clients",value:D.toString()}),(0,t.jsx)(S,{label:"User Created",value:O}),(0,t.jsx)(S,{label:"Known As",value:f.join(",")}),(0,t.jsxs)(p.Z,{accordion:!0,children:[(0,t.jsx)(_,{header:"Currently Connected Clients",children:(0,t.jsx)(p.Z,{accordion:!0,children:h.map(e=>(0,t.jsx)(_,{header:(0,C.AB)(e.userAgent),children:(0,t.jsx)(P,{client:e})},e.id))})},"connected-clients"),(0,t.jsx)(p.Z,{accordion:!0,children:(0,t.jsx)(_,{header:"Recent Chat Messages",children:(0,t.jsx)(g.Z,{size:"small",pagination:null,columns:[{title:"Message",dataIndex:"body",key:"body"},{title:"Sent At",dataIndex:"timestamp",key:"timestamp",render:e=>(0,w.Z)(new Date(e),"PP pp")},{title:"Delete",key:"delete",render:(e,n)=>(0,t.jsx)(m.Z,{type:"primary",ghost:!0,icon:(0,t.jsx)(M,{}),onClick:()=>Z(n.id,a)})}],dataSource:u,rowKey:"id"})},"chat-messages")})]})]})};var D=a(24110),O=a.n(D);let{confirm:T}=s.Z,B=h()(()=>Promise.all([a.e(2074),a.e(4337)]).then(a.t.bind(a,74337,23)),{loadableGenerated:{webpack:()=>[74337]},ssr:!1}),G=h()(()=>Promise.all([a.e(2074),a.e(7039)]).then(a.t.bind(a,67039,23)),{loadableGenerated:{webpack:()=>[67039]},ssr:!1}),I=h()(()=>Promise.all([a.e(2074),a.e(4645)]).then(a.t.bind(a,84645,23)),{loadableGenerated:{webpack:()=>[84645]},ssr:!1}),U=h()(()=>Promise.all([a.e(2074),a.e(500)]).then(a.t.bind(a,40500,23)),{loadableGenerated:{webpack:()=>[40500]},ssr:!1}),z=e=>{let{messageID:n,userID:a,userDisplayName:s,accessToken:d}=e,[h,p]=(0,c.useState)(!1),x=async()=>{try{await f.banUser(a,d)}catch(e){console.error(e),o.ZP.error(e)}},j=async()=>{try{await f.removeMessage(n,d)}catch(e){console.error(e),o.ZP.error(e)}},m=async()=>{T({icon:(0,t.jsx)(G,{}),content:"Are you sure you want to remove this message from ".concat(s,"?"),onOk(){j()}})},y=async()=>{T({icon:(0,t.jsx)(G,{}),content:"Are you sure you want to ban ".concat(s," from chat?"),onOk(){x()}})},b=e=>{let{key:n}=e;"hide-message"===n?m():"ban-user"===n?y():"more-info"===n&&p(!0)},g=(0,t.jsx)(l.Z,{onClick:b,items:[{label:(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:O().icon,children:(0,t.jsx)(I,{})}),"Hide Message"]}),key:"hide-message"},{label:(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:O().icon,children:(0,t.jsx)(B,{})}),"Ban User"]}),key:"ban-user"},{label:(0,t.jsx)("div",{children:"More Info..."}),key:"more-info"}]});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Z,{overlay:g,trigger:["click"],children:(0,t.jsx)("button",{type:"button",onClick:e=>e.preventDefault(),children:(0,t.jsx)(i.Z,{children:(0,t.jsx)(U,{})})})}),(0,t.jsx)(u.Modal,{title:s,open:h,handleCancel:()=>{p(!1)},children:(0,t.jsx)(N,{userId:a,accessToken:d})})]})}},14761:function(e,n,a){"use strict";a.r(n),a.d(n,{Modal:function(){return d}});var t=a(85893),s=a(85402),o=a(26303),l=a(11382),r=a(67294),i=a(77011),c=a.n(i);let d=e=>{let{title:n,url:a,open:i,handleOk:d,handleCancel:h,afterClose:u,height:p,width:x,children:j}=e,[m,y]=(0,r.useState)(!!a),b="100%",g="520px";a&&(b="70vh",g="900px");let w={padding:"0px",minHeight:p,height:null!=p?p:b},f=a&&(0,t.jsx)("iframe",{title:n,src:a,width:"100%",height:"100%",sandbox:"allow-same-origin allow-scripts allow-popups allow-forms",frameBorder:"0",allowFullScreen:!0,style:{display:"block"},onLoad:()=>y(!1)});return(0,t.jsx)(s.Z,{title:n,open:i,onOk:d,onCancel:h,afterClose:u,bodyStyle:w,width:null!=x?x:g,zIndex:999,footer:null,centered:!0,destroyOnClose:!0,children:(0,t.jsxs)("div",{id:"modal-container",style:{height:"100%"},children:[m&&(0,t.jsx)(o.Z,{active:m,style:{padding:"10px"},paragraph:{rows:10}}),f&&(0,t.jsx)("div",{style:{display:m?"none":"inline"},children:f}),j&&(0,t.jsx)("div",{className:c().content,children:j}),m&&(0,t.jsx)(l.Z,{className:c().spinner,spinning:m,size:"large"})]})})};n.default=d,d.defaultProps={url:void 0,children:void 0,handleOk:void 0,handleCancel:void 0,afterClose:void 0}},24110:function(e){e.exports={icon:"ChatModerationActionMenu_icon__9j6DF"}},57761:function(e){e.exports={modalContainer:"ChatModerationDetailsModal_modalContainer__czndV",chatHistory:"ChatModerationDetailsModal_chatHistory__PunRk",colorBlock:"ChatModerationDetailsModal_colorBlock___rAlw",displayName:"ChatModerationDetailsModal_displayName__p7pLI"}},77011:function(e){e.exports={spinner:"Modal_spinner__GiSS0",content:"Modal_content__h9my9"}}}]);
//# sourceMappingURL=4860.7b36b125b2aaafb5.js.map